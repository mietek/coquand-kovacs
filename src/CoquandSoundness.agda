module CoquandSoundness where

open import CoquandCompleteness public


--------------------------------------------------------------------------------


-- UnâŸ¦_âŸ§
postulate
  âŸ¦_âŸ§Un : âˆ€ {Î“ Î A} â†’ {Ï : Î“ âŠ©â‹† Î}
                    â†’ (M : Î âŠ¢ A) â†’ Unâ‹† Ï
                    â†’ Un (âŸ¦ M âŸ§ Ï)

-- ğ’°â‹†âŸ¦_âŸ§â‚›
postulate
  âŸ¦_âŸ§Unâ‹† : âˆ€ {Î“ Î Î¦} â†’ {Ï : Î“ âŠ©â‹† Î}
                     â†’ (Ïƒ : Î âŠ¢â‹† Î¦) â†’ Unâ‹† Ï
                     â†’ Unâ‹† (âŸ¦ Ïƒ âŸ§â‹† Ï)

postulate
  âŸ¦_âŸ§Eq : âˆ€ {Î“ Î A} â†’ {Ïâ‚ Ïâ‚‚ : Î“ âŠ©â‹† Î}
                    â†’ (M : Î âŠ¢ A) â†’ Eqâ‹† Ïâ‚ Ïâ‚‚ â†’ Unâ‹† Ïâ‚ â†’ Unâ‹† Ïâ‚‚
                    â†’ Eq (âŸ¦ M âŸ§ Ïâ‚) (âŸ¦ M âŸ§ Ïâ‚‚)

-- Eqâ‹†âŸ¦_âŸ§â‚›
postulate
  âŸ¦_âŸ§Eqâ‹† : âˆ€ {Î“ Î Î¦} â†’ {Ïâ‚ Ïâ‚‚ : Î“ âŠ©â‹† Î}
                     â†’ (Ïƒ : Î âŠ¢â‹† Î¦) â†’ Eqâ‹† Ïâ‚ Ïâ‚‚ â†’ Unâ‹† Ïâ‚ â†’ Unâ‹† Ïâ‚‚
                     â†’ Eqâ‹† (âŸ¦ Ïƒ âŸ§â‹† Ïâ‚) (âŸ¦ Ïƒ âŸ§â‹† Ïâ‚‚)


--------------------------------------------------------------------------------


-- âŸ¦_âŸ§â¬—Eq = symEq âˆ˜ â†‘âŸ¨_âŸ©EqâŸ¦_âŸ§
âŸ¦_âŸ§â¬—Eq : âˆ€ {Î“ Î“â€² Î A} â†’ {Ï : Î“ âŠ©â‹† Î}
                      â†’ (M : Î âŠ¢ A) (Î· : Î“â€² âˆ‹â‹† Î“) â†’ Unâ‹† Ï
                      â†’ Eq (âŸ¦ M âŸ§ (Î· â¬— Ï))
                            (acc Î· (âŸ¦ M âŸ§ Ï))

âŸ¦_âŸ§â¬—Eq (` i)   Î· Ï… = getâ¬—Eq Î· i Ï…

âŸ¦_âŸ§â¬—Eq (Æ› M)   Î· Ï… = eqâŠƒ (Î» Î·â€² u â†’
                           âŸ¦ M âŸ§Eq (compâ¬—â—‡Eqâ‹† Î·â€² Î· Ï… , reflEq u)
                                   (congâ¬—Unâ‹† Î·â€² (congâ¬—Unâ‹† Î· Ï…) , u)
                                   (congâ¬—Unâ‹† (Î·â€² â—‹ Î·) Ï… , u))

âŸ¦_âŸ§â¬—Eq (M âˆ™ N) Î· Ï… =
    congâ—Eq idáµ£ (âŸ¦ M âŸ§â¬—Eq Î· Ï…) (âŸ¦ M âŸ§Un (congâ¬—Unâ‹† Î· Ï…)) (congaccUn Î· (âŸ¦ M âŸ§Un Ï…))
                (âŸ¦ N âŸ§â¬—Eq Î· Ï…) (âŸ¦ N âŸ§Un (congâ¬—Unâ‹† Î· Ï…)) (congaccUn Î· (âŸ¦ N âŸ§Un Ï…))
  â¦™ accâ—idEq Î· (âŸ¦ M âŸ§Un Ï…) (congaccUn Î· (âŸ¦ N âŸ§Un Ï…))
  â¦™ (congâ—Eq Î· ((lidaccEq (âŸ¦ M âŸ§Un Ï…)) â»Â¹) (âŸ¦ M âŸ§Un Ï…) (congaccUn idáµ£ (âŸ¦ M âŸ§Un Ï…))
               (reflEq (congaccUn Î· (âŸ¦ N âŸ§Un Ï…))) (congaccUn Î· (âŸ¦ N âŸ§Un Ï…)) (congaccUn Î· (âŸ¦ N âŸ§Un Ï…))
  â¦™ accâ—Eq idáµ£ Î· (âŸ¦ M âŸ§Un Ï…) (âŸ¦ N âŸ§Un Ï…))


-- âŸ¦_âŸ§â¬—Eqâ‹† = symEq âˆ˜ â†‘âŸ¨_âŸ©Eqâ‹†âŸ¦_âŸ§â‚›
âŸ¦_âŸ§â¬—Eqâ‹† : âˆ€ {Î“ Î“â€² Î Î¦} â†’ {Ï : Î“ âŠ©â‹† Î}
                       â†’ (Ïƒ : Î âŠ¢â‹† Î¦) (Î· : Î“â€² âˆ‹â‹† Î“) â†’ Unâ‹† Ï
                       â†’ Eqâ‹† (âŸ¦ Ïƒ âŸ§â‹† (Î· â¬— Ï))
                              (Î· â¬— âŸ¦ Ïƒ âŸ§â‹† Ï)
âŸ¦_âŸ§â¬—Eqâ‹† âˆ…       Î· Ï… = âˆ…
âŸ¦_âŸ§â¬—Eqâ‹† (Ïƒ , M) Î· Ï… = âŸ¦ Ïƒ âŸ§â¬—Eqâ‹† Î· Ï… , âŸ¦ M âŸ§â¬—Eq Î· Ï…


--------------------------------------------------------------------------------


-- TODO: Generalise to zapâ¬–
postulate
  auxâ‚„â‚ˆâ‚ : âˆ€ {Î“ Î A} â†’ {Ï : Î“ âŠ©â‹† Î} {a : Î“ âŠ© A}
                     â†’ Unâ‹† Ï
                     â†’ Eqâ‹† ((Ï , a) â¬– wkáµ£ idáµ£) Ï


-- TODO
-- Basic properties of _â—‡_
-- Advanced properties of _â—‡_
-- Basic properties of _â¬—_
-- Basic properties of _â—†_
-- Advanced properties of _â¬—_
-- Advanced properties of _â—†_


-- TODO: Fix the instance argument problem; abstract over models; rename Î· to Î¾â€¦


--------------------------------------------------------------------------------


renliftâŸ¦_âŸ§Eq : âˆ€ {Î“ Î“â€² A B w wâ€²} â†’ {Ï : w âŠ©â‹† Î“â€²} {a : wâ€² âŠ© A}
                                 â†’ (M : Î“ , A âŠ¢ B) (Î·â‚ : Î“â€² âˆ‹â‹† Î“) (Î·â‚‚ : wâ€² âˆ‹â‹† w) â†’ Unâ‹† Ï â†’ Un a
                                 â†’ Eq (âŸ¦ ren (liftáµ£ {A} Î·â‚) M âŸ§ (Î·â‚‚ â¬— Ï , a))
                                       (âŸ¦ M âŸ§ (Î·â‚‚ â¬— (Ï â¬– Î·â‚) , a))

renliftâŸ¦_âŸ§Eq (` zero) Î·â‚ Î·â‚‚ Ï… u = reflEq u

renliftâŸ¦_âŸ§Eq {Ï = Ï} {a} (` (suc i)) Î·â‚ Î·â‚‚ Ï… u =
    â‰¡â†’Eq ((getáµ¥ (Î·â‚‚ â¬— Ï , a)) & natgetáµ£ Î·â‚ i)
          (conggetUn (getáµ£ (wkáµ£ Î·â‚) i) (congâ¬—Unâ‹† Î·â‚‚ Ï… , u))
  â¦™ getâ¬–Eq Î·â‚ (getáµ£ Î·â‚ i) i (congâ¬—Unâ‹† Î·â‚‚ Ï…) â»Â¹
  â¦™ conggetEq i (compâ¬—â¬–Eqâ‹† Î·â‚‚ Î·â‚ Ï… â»Â¹)

renliftâŸ¦_âŸ§Eq (Æ› M) Î·â‚ Î·â‚‚ Ï… u =
      eqâŠƒ (Î» Î·â€² uâ€² â†’ renliftâŸ¦ M âŸ§Eq (liftáµ£ Î·â‚) Î·â€² (congâ¬—Unâ‹† Î·â‚‚ Ï… , u) uâ€²
                    â¦™ âŸ¦ M âŸ§Eq ( ( congâ¬—Eqâ‹† Î·â€² (( compâ¬—â¬–Eqâ‹† Î·â‚‚ Î·â‚ Ï…
                                               â¦™ zapâ¬–Eqâ‹† (wkáµ£ Î·â‚) Î·â‚ (congâ¬—Unâ‹† Î·â‚‚ Ï…) â»Â¹
                                               ) â»Â¹)
                                , reflEq (congaccUn Î·â€² u)
                                )
                              , reflEq uâ€²
                              )
                              ((congâ¬—Unâ‹† Î·â€² (congâ¬–Unâ‹† (wkáµ£ Î·â‚) (congâ¬—Unâ‹† Î·â‚‚ Ï… , u)) , congaccUn Î·â€² u) , uâ€²)
                              ((congâ¬—Unâ‹† Î·â€² (congâ¬—Unâ‹† Î·â‚‚ (congâ¬–Unâ‹† Î·â‚ Ï…)) , congaccUn Î·â€² u) , uâ€²))

renliftâŸ¦_âŸ§Eq (M âˆ™ N) Î·â‚ Î·â‚‚ Ï… u =
  congâ—Eq idáµ£ (renliftâŸ¦ M âŸ§Eq Î·â‚ Î·â‚‚ Ï… u) (âŸ¦ ren (liftáµ£ Î·â‚) M âŸ§Un (congâ¬—Unâ‹† Î·â‚‚ Ï… , u)) (âŸ¦ M âŸ§Un (congâ¬—Unâ‹† Î·â‚‚ (congâ¬–Unâ‹† Î·â‚ Ï…) , u))
              (renliftâŸ¦ N âŸ§Eq Î·â‚ Î·â‚‚ Ï… u) (âŸ¦ ren (liftáµ£ Î·â‚) N âŸ§Un (congâ¬—Unâ‹† Î·â‚‚ Ï… , u)) (âŸ¦ N âŸ§Un (congâ¬—Unâ‹† Î·â‚‚ (congâ¬–Unâ‹† Î·â‚ Ï…) , u))


--------------------------------------------------------------------------------


renwkâŸ¦_âŸ§Eq : âˆ€ {Î“ Î“â€² A C w} â†’ {Ï : w âŠ©â‹† Î“â€²} {a : w âŠ© A}
                            â†’ (M : Î“ âŠ¢ C) (Î· : Î“â€² âˆ‹â‹† Î“) â†’ Unâ‹† Ï â†’ Un a
                            â†’ Eq (âŸ¦ ren (wkáµ£ {A} Î·) M âŸ§ (Ï , a))
                                  (âŸ¦ M âŸ§ (Ï â¬– Î·))

renwkâŸ¦_âŸ§Eq (` i) Î· Ï… u =
    getâ¬–Eq (wkáµ£ Î·) (getáµ£ (wkáµ£ Î·) i) i (Ï… , u) â»Â¹
  â¦™ conggetEq i (zapâ¬–Eqâ‹† (wkáµ£ Î·) Î· Ï…)

renwkâŸ¦_âŸ§Eq (Æ› M) Î· Ï… u =
  eqâŠƒ (Î» Î·â€² uâ€² â†’ renliftâŸ¦ M âŸ§Eq (wkáµ£ Î·) Î·â€² (Ï… , u) uâ€²
                â¦™ âŸ¦ M âŸ§Eq (congâ¬—Eqâ‹† Î·â€² (zapâ¬–Eqâ‹† (wkáµ£ Î·) Î· Ï…) , reflEq uâ€²)
                          (congâ¬—Unâ‹† Î·â€² (congâ¬–Unâ‹† (wkáµ£ Î·) (Ï… , u)) , uâ€²)
                          (congâ¬—Unâ‹† Î·â€² (congâ¬–Unâ‹† Î· Ï…) , uâ€²))

renwkâŸ¦_âŸ§Eq (M âˆ™ N) Î· Ï… u =
  congâ—Eq idáµ£ (renwkâŸ¦ M âŸ§Eq Î· Ï… u) (âŸ¦ ren (wkáµ£ Î·) M âŸ§Un (Ï… , u)) (âŸ¦ M âŸ§Un (congâ¬–Unâ‹† Î· Ï…))
              (renwkâŸ¦ N âŸ§Eq Î· Ï… u) (âŸ¦ ren (wkáµ£ Î·) N âŸ§Un (Ï… , u)) (âŸ¦ N âŸ§Un (congâ¬–Unâ‹† Î· Ï…))


--------------------------------------------------------------------------------


wkâŸ¦_âŸ§Eq : âˆ€ {Î“ A C w} â†’ {Ï : w âŠ©â‹† Î“} {a : w âŠ© A}
                      â†’ (M : Î“ âŠ¢ C) â†’ Unâ‹† Ï â†’ Un a
                      â†’ Eq (âŸ¦ wk {A} M âŸ§ (Ï , a))
                            (âŸ¦ M âŸ§ Ï)
wkâŸ¦_âŸ§Eq M Ï… u = renwkâŸ¦ M âŸ§Eq idáµ£ Ï… u
              â¦™ âŸ¦ M âŸ§Eq (ridâ¬–Eqâ‹† Ï…) (congâ¬–Unâ‹† idáµ£ Ï…) Ï…

wkâŸ¦_âŸ§Eqâ‹† : âˆ€ {Î“ Î A w} â†’ {Ï : w âŠ©â‹† Î“} {a : w âŠ© A}
                       â†’ (Ïƒ : Î“ âŠ¢â‹† Î) â†’ Unâ‹† Ï â†’ Un a
                       â†’ Eqâ‹† (âŸ¦ wkâ‚› {A} Ïƒ âŸ§â‹† (Ï , a))
                              (âŸ¦ Ïƒ âŸ§â‹† Ï)
wkâŸ¦_âŸ§Eqâ‹† âˆ…       Ï… u = âˆ…
wkâŸ¦_âŸ§Eqâ‹† (Ïƒ , M) Ï… u = wkâŸ¦ Ïƒ âŸ§Eqâ‹† Ï… u , wkâŸ¦ M âŸ§Eq Ï… u


--------------------------------------------------------------------------------


getâŸ¦_âŸ§Eq : âˆ€ {Î“ Î A w} â†’ {Ï : w âŠ©â‹† Î“}
                       â†’ (Ïƒ : Î“ âŠ¢â‹† Î) (i : Î âˆ‹ A) â†’ Unâ‹† Ï
                       â†’ Eq (âŸ¦ getâ‚› Ïƒ i âŸ§ Ï)
                             (getáµ¥ (âŸ¦ Ïƒ âŸ§â‹† Ï) i)
getâŸ¦_âŸ§Eq (Ïƒ , M) zero    Ï… = reflEq (âŸ¦ M âŸ§Un Ï…)
getâŸ¦_âŸ§Eq (Ïƒ , M) (suc i) Ï… = getâŸ¦ Ïƒ âŸ§Eq i Ï…


--------------------------------------------------------------------------------


subliftâŸ¦_âŸ§Eq : âˆ€ {Î“ Î A B w} â†’ {Ï : w âŠ©â‹† Î“} {a : w âŠ© A}
                             â†’ (M : Î , A âŠ¢ B) (Ïƒ : Î“ âŠ¢â‹† Î) â†’ Unâ‹† Ï â†’ Un a
                             â†’ Eq (âŸ¦ sub (liftâ‚› {A} Ïƒ) M âŸ§ (Ï , a))
                                   (âŸ¦ M âŸ§ (âŸ¦ Ïƒ âŸ§â‹† Ï , a))

subliftâŸ¦_âŸ§Eq (` zero) Ïƒ Ï… u = reflEq u

subliftâŸ¦_âŸ§Eq {Ï = Ï} {a} (` (suc i)) Ïƒ Ï… u =
    â‰¡â†’Eq ((Î» Mâ€² â†’ âŸ¦ Mâ€² âŸ§ (Ï , a)) & natgetâ‚› Ïƒ i)
          (âŸ¦ getâ‚› (wkâ‚› Ïƒ) i âŸ§Un (Ï… , u))
  â¦™ wkâŸ¦ getâ‚› Ïƒ i âŸ§Eq Ï… u
  â¦™ getâŸ¦ Ïƒ âŸ§Eq i Ï…

subliftâŸ¦_âŸ§Eq (Æ› M) Ïƒ Ï… u =
  eqâŠƒ (Î» Î·â€² uâ€² â†’ subliftâŸ¦ M âŸ§Eq (liftâ‚› Ïƒ) (congâ¬—Unâ‹† Î·â€² Ï… , congaccUn Î·â€² u) uâ€²
                â¦™ âŸ¦ M âŸ§Eq ((âŸ¦ wkâ‚› Ïƒ âŸ§â¬—Eqâ‹† Î·â€² (Ï… , u) , reflEq (congaccUn Î·â€² u)) , reflEq uâ€²)
                          ((âŸ¦ wkâ‚› Ïƒ âŸ§Unâ‹† (congâ¬—Unâ‹† Î·â€² Ï… , congaccUn Î·â€² u) , congaccUn Î·â€² u) , uâ€²)
                          ((congâ¬—Unâ‹† Î·â€² (âŸ¦ wkâ‚› Ïƒ âŸ§Unâ‹† (Ï… , u)) , congaccUn Î·â€² u) , uâ€²)
                â¦™ âŸ¦ M âŸ§Eq ((congâ¬—Eqâ‹† Î·â€² (wkâŸ¦ Ïƒ âŸ§Eqâ‹† Ï… u) , reflEq (congaccUn Î·â€² u)) , reflEq uâ€²)
                          ((congâ¬—Unâ‹† Î·â€² (âŸ¦ wkâ‚› Ïƒ âŸ§Unâ‹† (Ï… , u)) , congaccUn Î·â€² u) , uâ€²)
                          ((congâ¬—Unâ‹† Î·â€² (âŸ¦ Ïƒ âŸ§Unâ‹† Ï…) , congaccUn Î·â€² u) , uâ€²))

subliftâŸ¦_âŸ§Eq (M âˆ™ N) Ïƒ Ï… u =
  congâ—Eq idáµ£ (subliftâŸ¦ M âŸ§Eq Ïƒ Ï… u) (âŸ¦ sub (liftâ‚› Ïƒ) M âŸ§Un (Ï… , u)) (âŸ¦ M âŸ§Un (âŸ¦ Ïƒ âŸ§Unâ‹† Ï… , u))
              (subliftâŸ¦ N âŸ§Eq Ïƒ Ï… u) (âŸ¦ sub (liftâ‚› Ïƒ) N âŸ§Un (Ï… , u)) (âŸ¦ N âŸ§Un (âŸ¦ Ïƒ âŸ§Unâ‹† Ï… , u))


--------------------------------------------------------------------------------


subliftwkâŸ¦_âŸ§Eq : âˆ€ {Î“ Î A Aâ€² B w wâ€²} â†’ {Ï : w âŠ©â‹† Î“} {a : w âŠ© A} {aâ€² : wâ€² âŠ© Aâ€²}
                                     â†’ (M : Î , Aâ€² âŠ¢ B) (Ïƒ : Î“ âŠ¢â‹† Î) (Î· : wâ€² âˆ‹â‹† w) â†’ Unâ‹† Ï â†’ Un a â†’ Un aâ€²
                                     â†’ Eq (âŸ¦ sub (liftâ‚› (wkâ‚› Ïƒ)) M âŸ§ (Î· â¬— Ï , acc Î· a , aâ€²))
                                           (âŸ¦ sub (liftâ‚› Ïƒ) M âŸ§ (Î· â¬— Ï , aâ€²))
subliftwkâŸ¦_âŸ§Eq M Ïƒ Î· Ï… u uâ€² = subliftâŸ¦ M âŸ§Eq (wkâ‚› Ïƒ) (congâ¬—Unâ‹† Î· Ï… , congaccUn Î· u) uâ€²
                            â¦™ âŸ¦ M âŸ§Eq (wkâŸ¦ Ïƒ âŸ§Eqâ‹† (congâ¬—Unâ‹† Î· Ï…) (congaccUn Î· u) , reflEq uâ€²)
                                      (âŸ¦ wkâ‚› Ïƒ âŸ§Unâ‹† (congâ¬—Unâ‹† Î· Ï… , congaccUn Î· u) , uâ€²)
                                      (âŸ¦ Ïƒ âŸ§Unâ‹† (congâ¬—Unâ‹† Î· Ï…) , uâ€²)
                            â¦™ subliftâŸ¦ M âŸ§Eq Ïƒ (congâ¬—Unâ‹† Î· Ï…) uâ€² â»Â¹


--------------------------------------------------------------------------------


subwkâŸ¦_âŸ§Eq : âˆ€ {Î“ Î A C w} â†’ {Ï : w âŠ©â‹† Î“} {a : w âŠ© A}
                           â†’ (M : Î âŠ¢ C) (Ïƒ : Î“ âŠ¢â‹† Î) â†’ Unâ‹† Ï â†’ Un a
                           â†’ Eq (âŸ¦ sub (wkâ‚› {A} Ïƒ) M âŸ§ (Ï , a))
                                 (âŸ¦ sub Ïƒ M âŸ§ Ï)

subwkâŸ¦_âŸ§Eq {Ï = Ï} {a} (` i) Ïƒ Ï… u =
    â‰¡â†’Eq ((Î» Mâ€² â†’ âŸ¦ Mâ€² âŸ§ (Ï , a)) & (natgetâ‚› Ïƒ i))
          (âŸ¦ getâ‚› (wkâ‚› Ïƒ) i âŸ§Un (Ï… , u))
  â¦™ wkâŸ¦ getâ‚› Ïƒ i âŸ§Eq Ï… u

subwkâŸ¦_âŸ§Eq (Æ› {A = Aâ€²} M) Ïƒ Ï… u =
  eqâŠƒ (Î» Î· uâ€² â†’ subliftwkâŸ¦ M âŸ§Eq Ïƒ Î· Ï… u uâ€²)

subwkâŸ¦_âŸ§Eq (M âˆ™ N) Ïƒ Ï… u =
  congâ—Eq idáµ£ (subwkâŸ¦ M âŸ§Eq Ïƒ Ï… u) (âŸ¦ sub (wkâ‚› Ïƒ) M âŸ§Un (Ï… , u)) (âŸ¦ sub Ïƒ M âŸ§Un Ï…)
              (subwkâŸ¦ N âŸ§Eq Ïƒ Ï… u) (âŸ¦ sub (wkâ‚› Ïƒ) N âŸ§Un (Ï… , u)) (âŸ¦ sub Ïƒ N âŸ§Un Ï…)


--------------------------------------------------------------------------------


subâŸ¦_âŸ§Eq : âˆ€ {Î“ Î A w} â†’ {Ï : w âŠ©â‹† Î“}
                       â†’ (M : Î âŠ¢ A) (Ïƒ : Î“ âŠ¢â‹† Î) â†’ Unâ‹† Ï
                       â†’ Eq (âŸ¦ sub Ïƒ M âŸ§ Ï)
                             (âŸ¦ M âŸ§ (âŸ¦ Ïƒ âŸ§â‹† Ï))

subâŸ¦_âŸ§Eq (` i) Ïƒ Ï… = getâŸ¦ Ïƒ âŸ§Eq i Ï…

subâŸ¦_âŸ§Eq (Æ› M) Ïƒ Ï… =
  eqâŠƒ (Î» Î· u â†’ subliftâŸ¦ M âŸ§Eq Ïƒ (congâ¬—Unâ‹† Î· Ï…) u
              â¦™ âŸ¦ M âŸ§Eq (âŸ¦ Ïƒ âŸ§â¬—Eqâ‹† Î· Ï… , reflEq u)
                        (âŸ¦ Ïƒ âŸ§Unâ‹† (congâ¬—Unâ‹† Î· Ï…) , u)
                        (congâ¬—Unâ‹† Î· (âŸ¦ Ïƒ âŸ§Unâ‹† Ï…) , u))

subâŸ¦_âŸ§Eq (M âˆ™ N) Ïƒ Ï… =
  congâ—Eq idáµ£ (subâŸ¦ M âŸ§Eq Ïƒ Ï…) (âŸ¦ sub Ïƒ M âŸ§Un Ï…) (âŸ¦ M âŸ§Un (âŸ¦ Ïƒ âŸ§Unâ‹† Ï…))
              (subâŸ¦ N âŸ§Eq Ïƒ Ï…) (âŸ¦ sub Ïƒ N âŸ§Un Ï…) (âŸ¦ N âŸ§Un (âŸ¦ Ïƒ âŸ§Unâ‹† Ï…))


--------------------------------------------------------------------------------


-- TODO: Rename this
subliftâŸ¦âŸ§Eqâˆ : âˆ€ {Î“ Î A B w} â†’ {Ï : w âŠ©â‹† Î“}
                             â†’ (Ïƒ : Î“ âŠ¢â‹† Î) (M : Î , A âŠ¢ B) (N : Î“ âŠ¢ A) â†’ Unâ‹† Ï
                             â†’ Eq (âŸ¦ sub (liftâ‚› {A} Ïƒ) M âŸ§ (Ï , âŸ¦ N âŸ§ Ï))
                                   (âŸ¦ sub (Ïƒ , N) M âŸ§ Ï)
subliftâŸ¦âŸ§Eqâˆ {Ï = Ï} Ïƒ M N Ï… = subliftâŸ¦ M âŸ§Eq Ïƒ Ï… (âŸ¦ N âŸ§Un Ï…)
                             â¦™ subâŸ¦ M âŸ§Eq (Ïƒ , N) Ï… â»Â¹


--------------------------------------------------------------------------------


-- TODO: Generalise theorem 4 over models

module _ where
  open ğ” canon

  mutual
    lemÆ› : âˆ€ {Î“ A B w} â†’ {Ï : w âŠ©â‹† Î“} {M Mâ€² : Î“ , A âŠ¢ B}
                       â†’ M âˆ¼ Mâ€² â†’ Unâ‹† Ï
                       â†’ Eq (âŸ¦ Æ› M âŸ§ Ï) (âŸ¦ Æ› Mâ€² âŸ§ Ï)
    lemÆ› p Ï… = eqâŠƒ (Î» xs u â†’ congâŸ¦ p âŸ§Eq (congâ¬—Unâ‹† xs Ï… , u))

    lemâˆ™ : âˆ€ {Î“ A B w} â†’ {Ï : w âŠ©â‹† Î“} {M Mâ€² : Î“ âŠ¢ A âŠƒ B} {N Nâ€² : Î“ âŠ¢ A}
                       â†’ M âˆ¼ Mâ€² â†’ N âˆ¼ Nâ€² â†’ Unâ‹† Ï
                       â†’ Eq (âŸ¦ M âˆ™ N âŸ§ Ï) (âŸ¦ Mâ€² âˆ™ Nâ€² âŸ§ Ï)
    lemâˆ™ {M = M} {Mâ€²} {N} {Nâ€²} p q Ï… = congâ—Eq idáµ£ (congâŸ¦ p âŸ§Eq Ï…) (âŸ¦ M âŸ§Un Ï…) (âŸ¦ Mâ€² âŸ§Un Ï…)
                                                   (congâŸ¦ q âŸ§Eq Ï…) (âŸ¦ N âŸ§Un Ï…) (âŸ¦ Nâ€² âŸ§Un Ï…)

    lemÎ²red : âˆ€ {Î“ Î A B w} â†’ {Ï : w âŠ©â‹† Î“}
                            â†’ (Ïƒ : Î“ âŠ¢â‹† Î) (M : Î , A âŠ¢ B) (N : Î“ âŠ¢ A) â†’ Unâ‹† Ï
                            â†’ Eq (âŸ¦ sub Ïƒ (Æ› M) âˆ™ N âŸ§ Ï) (âŸ¦ sub (Ïƒ , N) M âŸ§ Ï)
    lemÎ²red {Ï = Ï} Ïƒ M N Ï… =
        âŸ¦ sub (liftâ‚› Ïƒ) M âŸ§Eq (lidâ¬—Eqâ‹† Ï… , reflEq (âŸ¦ N âŸ§Un Ï…))
                              (congâ¬—Unâ‹† idáµ£ Ï… , âŸ¦ N âŸ§Un Ï…)
                              (Ï… , âŸ¦ N âŸ§Un Ï…)
      â¦™ subliftâŸ¦âŸ§Eqâˆ Ïƒ M N Ï…

    lemÎ·exp : âˆ€ {Î“ A B w} â†’ {Ï : w âŠ©â‹† Î“}
                          â†’ (M : Î“ âŠ¢ A âŠƒ B) â†’ Unâ‹† Ï
                          â†’ Eq (âŸ¦ M âŸ§ Ï) (âŸ¦ Æ› (wk M âˆ™ ` zero) âŸ§ Ï)
    lemÎ·exp {Ï = Ï} M Ï… =
      eqâŠƒ (Î» Î· {a} u â†’ accâ—idEq Î· (âŸ¦ M âŸ§Un Ï…) u â»Â¹
                      â¦™ congâ—Eq idáµ£ (âŸ¦ M âŸ§â¬—Eq Î· Ï… â»Â¹) (congaccUn Î· (âŸ¦ M âŸ§Un Ï…)) (âŸ¦ M âŸ§Un (congâ¬—Unâ‹† Î· Ï…))
                                    (reflEq u) u u
                      â¦™ congâ—Eq idáµ£ (wkâŸ¦ M âŸ§Eq (congâ¬—Unâ‹† Î· Ï…) u â»Â¹) (âŸ¦ M âŸ§Un (congâ¬—Unâ‹† Î· Ï…)) (âŸ¦ wk M âŸ§Un (congâ¬—Unâ‹† Î· Ï… , u))
                                    (reflEq u) u u)

    -- Theorem 4.
    congâŸ¦_âŸ§Eq : âˆ€ {Î“ A w} â†’ {M Mâ€² : Î“ âŠ¢ A} {Ï : w âŠ©â‹† Î“}
                          â†’ M âˆ¼ Mâ€² â†’ Unâ‹† Ï
                          â†’ Eq (âŸ¦ M âŸ§ Ï) (âŸ¦ Mâ€² âŸ§ Ï)
    congâŸ¦ reflâˆ¼ {M = M} âŸ§Eq Ï… = reflEq (âŸ¦ M âŸ§Un Ï…)
    congâŸ¦ p â»Â¹âˆ¼ âŸ§Eq         Ï… = congâŸ¦ p âŸ§Eq Ï… â»Â¹
    congâŸ¦ p â¦™âˆ¼ q âŸ§Eq        Ï… = congâŸ¦ p âŸ§Eq Ï… â¦™ congâŸ¦ q âŸ§Eq Ï…
    congâŸ¦ Æ›âˆ¼ p âŸ§Eq          Ï… = lemÆ› p Ï…
    congâŸ¦ p âˆ™âˆ¼ q âŸ§Eq        Ï… = lemâˆ™ p q Ï…
    congâŸ¦ Î²redâˆ¼ Ïƒ M N âŸ§Eq   Ï… = lemÎ²red Ïƒ M N Ï…
    congâŸ¦ Î·expâˆ¼ M âŸ§Eq       Ï… = lemÎ·exp M Ï…


--------------------------------------------------------------------------------


-- Theorem 5.
thmâ‚… : âˆ€ {Î“ A} â†’ (M Mâ€² : Î“ âŠ¢ A) â†’ nf M â‰¡ nf Mâ€²
               â†’ M âˆ¼ Mâ€²
thmâ‚… M Mâ€² p = thmâ‚‚ M
            â¦™ â‰¡â†’âˆ¼ p
            â¦™ (thmâ‚‚ Mâ€² â»Â¹)


--------------------------------------------------------------------------------


-- projâŸ¨_âŸ©ğ’°â‹†
âŒŠ_âŒ‹áµ¤ : âˆ€ {Î“ Î“â€²} â†’ (Î· : Î“â€² âˆ‹â‹† Î“)
                â†’ Unâ‹† âŒŠ Î· âŒ‹áµ¥
âŒŠ âˆ… âŒ‹áµ¤     = âˆ…
âŒŠ Î· , i âŒ‹áµ¤ = âŒŠ Î· âŒ‹áµ¤ , âŸª` i âŸ«áµ¤

-- reflğ’°â‹†
idáµ¤ : âˆ€ {Î“} â†’ Unâ‹† (idáµ¥ {Î“})
idáµ¤ = âŒŠ idáµ£ âŒ‹áµ¤

-- Theorem 6.
thmâ‚† : âˆ€ {Î“ A} â†’ (M Mâ€² : Î“ âŠ¢ A) â†’ M âˆ¼ Mâ€²
               â†’ nf M â‰¡ nf Mâ€²
thmâ‚† M Mâ€² p = corâ‚ M Mâ€² (congâŸ¦ p âŸ§Eq idáµ¤)


--------------------------------------------------------------------------------
