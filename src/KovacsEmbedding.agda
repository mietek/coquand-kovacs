module KovacsEmbedding where

open import Syntax public
open import Category


--------------------------------------------------------------------------------


-- Embeddings (OPE ; âˆ™ ; drop ; keep)
infix 4 _âŠ‡_
data _âŠ‡_ : ğ’ â†’ ğ’ â†’ Set
  where
    done  : [] âŠ‡ []

    wkâ‚‘   : âˆ€ {Î“ Î“â€² A} â†’ (Î· : Î“â€² âŠ‡ Î“)
                       â†’ [ Î“â€² , A ] âŠ‡ Î“

    liftâ‚‘ : âˆ€ {Î“ Î“â€² A} â†’ (Î· : Î“â€² âŠ‡ Î“)
                       â†’ [ Î“â€² , A ] âŠ‡ [ Î“ , A ]


idâ‚‘ : âˆ€ {Î“} â†’ Î“ âŠ‡ Î“
idâ‚‘ {[]}        = done
idâ‚‘ {[ Î“ , A ]} = liftâ‚‘ idâ‚‘

-- (_âˆ˜â‚‘_)
_â—‹_ : âˆ€ {Î“ Î“â€² Î“â€³} â†’ Î“â€² âŠ‡ Î“ â†’ Î“â€³ âŠ‡ Î“â€² â†’ Î“â€³ âŠ‡ Î“
Î·â‚‚       â—‹ done     = Î·â‚‚
Î·â‚‚       â—‹ wkâ‚‘ Î·â‚   = wkâ‚‘ (Î·â‚‚ â—‹ Î·â‚)
wkâ‚‘ Î·â‚‚   â—‹ liftâ‚‘ Î·â‚ = wkâ‚‘ (Î·â‚‚ â—‹ Î·â‚)
liftâ‚‘ Î·â‚‚ â—‹ liftâ‚‘ Î·â‚ = liftâ‚‘ (Î·â‚‚ â—‹ Î·â‚)

-- (idlâ‚‘)
lidâ—‹ : âˆ€ {Î“ Î“â€²} â†’ (Î· : Î“â€² âŠ‡ Î“)
                â†’ idâ‚‘ â—‹ Î· â‰¡ Î·
lidâ—‹ done      = refl
lidâ—‹ (wkâ‚‘ Î·)   = wkâ‚‘ & lidâ—‹ Î·
lidâ—‹ (liftâ‚‘ Î·) = liftâ‚‘ & lidâ—‹ Î·

-- (idrâ‚‘)
ridâ—‹ : âˆ€ {Î“ Î“â€²} â†’ (Î· : Î“â€² âŠ‡ Î“)
                â†’ Î· â—‹ idâ‚‘ â‰¡ Î·
ridâ—‹ done      = refl
ridâ—‹ (wkâ‚‘ Î·)   = wkâ‚‘ & ridâ—‹ Î·
ridâ—‹ (liftâ‚‘ Î·) = liftâ‚‘ & ridâ—‹ Î·

-- (assâ‚‘)
assocâ—‹ : âˆ€ {Î“ Î“â€² Î“â€³ Î“â€´} â†’ (Î·â‚ : Î“â€´ âŠ‡ Î“â€³) (Î·â‚‚ : Î“â€³ âŠ‡ Î“â€²) (Î·â‚ƒ : Î“â€² âŠ‡ Î“)
                        â†’ (Î·â‚ƒ â—‹ Î·â‚‚) â—‹ Î·â‚ â‰¡ Î·â‚ƒ â—‹ (Î·â‚‚ â—‹ Î·â‚)
assocâ—‹ done       Î·â‚‚         Î·â‚ƒ         = refl
assocâ—‹ (wkâ‚‘ Î·â‚)   Î·â‚‚         Î·â‚ƒ         = wkâ‚‘ & assocâ—‹ Î·â‚ Î·â‚‚ Î·â‚ƒ
assocâ—‹ (liftâ‚‘ Î·â‚) (wkâ‚‘ Î·â‚‚)   Î·â‚ƒ         = wkâ‚‘ & assocâ—‹ Î·â‚ Î·â‚‚ Î·â‚ƒ
assocâ—‹ (liftâ‚‘ Î·â‚) (liftâ‚‘ Î·â‚‚) (wkâ‚‘ Î·â‚ƒ)   = wkâ‚‘ & assocâ—‹ Î·â‚ Î·â‚‚ Î·â‚ƒ
assocâ—‹ (liftâ‚‘ Î·â‚) (liftâ‚‘ Î·â‚‚) (liftâ‚‘ Î·â‚ƒ) = liftâ‚‘ & assocâ—‹ Î·â‚ Î·â‚‚ Î·â‚ƒ


--------------------------------------------------------------------------------


-- (âˆˆâ‚‘)
getâ‚‘ : âˆ€ {Î“ Î“â€² A} â†’ Î“â€² âŠ‡ Î“ â†’ Î“ âˆ‹ A â†’ Î“â€² âˆ‹ A
getâ‚‘ done      i       = i
getâ‚‘ (wkâ‚‘ Î·)   i       = suc (getâ‚‘ Î· i)
getâ‚‘ (liftâ‚‘ Î·) zero    = zero
getâ‚‘ (liftâ‚‘ Î·) (suc i) = suc (getâ‚‘ Î· i)

-- (âˆˆ-idâ‚‘)
idgetâ‚‘ : âˆ€ {Î“ A} â†’ (i : Î“ âˆ‹ A)
                 â†’ getâ‚‘ idâ‚‘ i â‰¡ i
idgetâ‚‘ zero    = refl
idgetâ‚‘ (suc i) = suc & idgetâ‚‘ i

-- (âˆˆ-âˆ˜â‚‘)
getâ—‹ : âˆ€ {Î“ Î“â€² Î“â€³ A} â†’ (Î·â‚ : Î“â€³ âŠ‡ Î“â€²) (Î·â‚‚ : Î“â€² âŠ‡ Î“) (i : Î“ âˆ‹ A)
                     â†’ getâ‚‘ (Î·â‚‚ â—‹ Î·â‚) i â‰¡ (getâ‚‘ Î·â‚ âˆ˜ getâ‚‘ Î·â‚‚) i
getâ—‹ done       done       ()
getâ—‹ (wkâ‚‘ Î·â‚)   Î·â‚‚         i       = suc & getâ—‹ Î·â‚ Î·â‚‚ i
getâ—‹ (liftâ‚‘ Î·â‚) (wkâ‚‘ Î·â‚‚)   i       = suc & getâ—‹ Î·â‚ Î·â‚‚ i
getâ—‹ (liftâ‚‘ Î·â‚) (liftâ‚‘ Î·â‚‚) zero    = refl
getâ—‹ (liftâ‚‘ Î·â‚) (liftâ‚‘ Î·â‚‚) (suc i) = suc & getâ—‹ Î·â‚ Î·â‚‚ i


--------------------------------------------------------------------------------


-- (Tmâ‚‘)
ren : âˆ€ {Î“ Î“â€² A} â†’ Î“â€² âŠ‡ Î“ â†’ Î“ âŠ¢ A â†’ Î“â€² âŠ¢ A
ren Î· (` i)   = ` (getâ‚‘ Î· i)
ren Î· (Æ› M)   = Æ› (ren (liftâ‚‘ Î·) M)
ren Î· (M âˆ™ N) = ren Î· M âˆ™ ren Î· N

wk : âˆ€ {B Î“ A} â†’ Î“ âŠ¢ A â†’ [ Î“ , B ] âŠ¢ A
wk M = ren (wkâ‚‘ idâ‚‘) M

-- (Tm-idâ‚‘)
idren : âˆ€ {Î“ A} â†’ (M : Î“ âŠ¢ A)
                â†’ ren idâ‚‘ M â‰¡ M
idren (` i)   = ` & idgetâ‚‘ i
idren (Æ› M)   = Æ› & idren M
idren (M âˆ™ N) = _âˆ™_ & idren M
                    âŠ— idren N

-- (Tm-âˆ˜â‚‘)
renâ—‹ : âˆ€ {Î“ Î“â€² Î“â€³ A} â†’ (Î·â‚ : Î“â€³ âŠ‡ Î“â€²) (Î·â‚‚ : Î“â€² âŠ‡ Î“) (M : Î“ âŠ¢ A)
                     â†’ ren (Î·â‚‚ â—‹ Î·â‚) M â‰¡ (ren Î·â‚ âˆ˜ ren Î·â‚‚) M
renâ—‹ Î·â‚ Î·â‚‚ (` i)   = ` & getâ—‹ Î·â‚ Î·â‚‚ i
renâ—‹ Î·â‚ Î·â‚‚ (Æ› M)   = Æ› & renâ—‹ (liftâ‚‘ Î·â‚) (liftâ‚‘ Î·â‚‚) M
renâ—‹ Î·â‚ Î·â‚‚ (M âˆ™ N) = _âˆ™_ & renâ—‹ Î·â‚ Î·â‚‚ M
                         âŠ— renâ—‹ Î·â‚ Î·â‚‚ N


--------------------------------------------------------------------------------


ğ—¢ğ—£ğ—˜ : Category ğ’ _âŠ‡_
ğ—¢ğ—£ğ—˜ =
  record
    { idâ‚“    = idâ‚‘
    ; _â‹„_    = _â—‹_
    ; lidâ‹„   = lidâ—‹
    ; ridâ‹„   = ridâ—‹
    ; assocâ‹„ = assocâ—‹
    }


getâ‚‘Psh : ğ’¯ â†’ Presheafâ‚€ ğ—¢ğ—£ğ—˜
getâ‚‘Psh A =
  record
    { Ï†â‚“   = _âˆ‹ A
    ; Ï†â‚˜   = getâ‚‘
    ; idÏ†â‚˜ = fext! idgetâ‚‘
    ; Ï†â‚˜â‹„  = Î» Î·â‚ Î·â‚‚ â†’ fext! (getâ—‹ Î·â‚‚ Î·â‚)
    }

renPsh : ğ’¯ â†’ Presheafâ‚€ ğ—¢ğ—£ğ—˜
renPsh A =
  record
    { Ï†â‚“   = _âŠ¢ A
    ; Ï†â‚˜   = ren
    ; idÏ†â‚˜ = fext! idren
    ; Ï†â‚˜â‹„  = Î» Î·â‚ Î·â‚‚ â†’ fext! (renâ—‹ Î·â‚‚ Î·â‚)
    }


--------------------------------------------------------------------------------
