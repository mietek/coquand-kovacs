module CoquandSubstitution where

open import CoquandRenaming public
open import Category


--------------------------------------------------------------------------------


-- Substitutions
infix 3 _âŠ¢â‹†_
data _âŠ¢â‹†_ : ğ’ â†’ ğ’ â†’ Set
  where
    âˆ…   : âˆ€ {Î“} â†’ Î“ âŠ¢â‹† âˆ…

    _,_ : âˆ€ {Î“ Î A} â†’ (Ïƒ : Î“ âŠ¢â‹† Î) (M : Î“ âŠ¢ A)
                    â†’ Î“ âŠ¢â‹† Î , A


putâ‚› : âˆ€ {Î Î“} â†’ (âˆ€ {A} â†’ Î âŠ¢ A â†’ Î“ âŠ¢ A) â†’ Î“ âŠ¢â‹† Î
putâ‚› {âˆ…}     f = âˆ…
putâ‚› {Î“ , A} f = putâ‚› (Î» M â†’ f (wk M)) , f (` zero)

getâ‚› : âˆ€ {Î“ Î A} â†’ Î“ âŠ¢â‹† Î â†’ Î âˆ‹ A â†’ Î“ âŠ¢ A
getâ‚› (Ïƒ , M) zero    = M
getâ‚› (Ïƒ , M) (suc i) = getâ‚› Ïƒ i

wkâ‚› : âˆ€ {A Î“ Î} â†’ Î“ âŠ¢â‹† Î â†’ Î“ , A âŠ¢â‹† Î
wkâ‚› âˆ…       = âˆ…
wkâ‚› (Ïƒ , M) = wkâ‚› Ïƒ , wk M

liftâ‚› : âˆ€ {A Î“ Î} â†’ Î“ âŠ¢â‹† Î â†’ Î“ , A âŠ¢â‹† Î , A
liftâ‚› Ïƒ = wkâ‚› Ïƒ , ` zero

idâ‚› : âˆ€ {Î“} â†’ Î“ âŠ¢â‹† Î“
idâ‚› {âˆ…}     = âˆ…
idâ‚› {Î“ , A} = liftâ‚› idâ‚›

sub : âˆ€ {Î“ Î A} â†’ Î“ âŠ¢â‹† Î â†’ Î âŠ¢ A â†’ Î“ âŠ¢ A
sub Ïƒ (` i)   = getâ‚› Ïƒ i
sub Ïƒ (Æ› M)   = Æ› (sub (liftâ‚› Ïƒ) M)
sub Ïƒ (M âˆ™ N) = sub Ïƒ M âˆ™ sub Ïƒ N

cut : âˆ€ {Î“ A B} â†’ Î“ âŠ¢ A â†’ Î“ , A âŠ¢ B â†’ Î“ âŠ¢ B
cut M N = sub (idâ‚› , M) N

-- NOTE: _â—_ = subâ‹†
_â—_ : âˆ€ {Î“ Î Î¦} â†’ Î“ âŠ¢â‹† Î â†’ Î âŠ¢â‹† Î¦ â†’ Î“ âŠ¢â‹† Î¦
Ïƒâ‚ â— âˆ…        = âˆ…
Ïƒâ‚ â— (Ïƒâ‚‚ , M) = Ïƒâ‚ â— Ïƒâ‚‚ , sub Ïƒâ‚ M


--------------------------------------------------------------------------------


-- (wkgetâ‚›)
natgetâ‚› : âˆ€ {Î“ Î A B} â†’ (Ïƒ : Î“ âŠ¢â‹† Î) (i : Î âˆ‹ A)
                      â†’ getâ‚› (wkâ‚› {B} Ïƒ) i â‰¡ (wk âˆ˜ getâ‚› Ïƒ) i
natgetâ‚› (Ïƒ , M) zero    = refl
natgetâ‚› (Ïƒ , M) (suc i) = natgetâ‚› Ïƒ i

idgetâ‚› : âˆ€ {Î“ A} â†’ (i : Î“ âˆ‹ A)
                 â†’ getâ‚› idâ‚› i â‰¡ ` i
idgetâ‚› zero    = refl
idgetâ‚› (suc i) = natgetâ‚› idâ‚› i
               â¦™ wk & idgetâ‚› i
               â¦™ ` & ( natgetáµ£ idáµ£ i
                     â¦™ suc & idgetáµ£ i
                     )

idsub : âˆ€ {Î“ A} â†’ (M : Î“ âŠ¢ A)
                â†’ sub idâ‚› M â‰¡ M
idsub (` i)   = idgetâ‚› i
idsub (Æ› M)   = Æ› & idsub M
idsub (M âˆ™ N) = _âˆ™_ & idsub M
                    âŠ— idsub N


--------------------------------------------------------------------------------


âŒŠ_âŒ‹ : âˆ€ {Î“ Î“â€²} â†’ Î“â€² âˆ‹â‹† Î“ â†’ Î“â€² âŠ¢â‹† Î“
âŒŠ âˆ… âŒ‹     = âˆ…
âŒŠ Î· , i âŒ‹ = âŒŠ Î· âŒ‹ , ` i

-- NOTE: _â—_ = getâ‚›â‹†
_â—_ : âˆ€ {Î“ Î Îâ€²} â†’ Î“ âŠ¢â‹† Îâ€² â†’ Îâ€² âˆ‹â‹† Î â†’ Î“ âŠ¢â‹† Î
Ïƒ â— Î· = Ïƒ â— âŒŠ Î· âŒ‹

-- NOTE: _â—‘_ = renâ‹†
_â—‘_ : âˆ€ {Î“ Î“â€² Î} â†’ Î“â€² âˆ‹â‹† Î“ â†’ Î“ âŠ¢â‹† Î â†’ Î“â€² âŠ¢â‹† Î
Î· â—‘ Ïƒ = âŒŠ Î· âŒ‹ â— Ïƒ


âŒŠgetâŒ‹ : âˆ€ {Î“ Î“â€² A} â†’ (Î· : Î“â€² âˆ‹â‹† Î“) (i : Î“ âˆ‹ A)
                   â†’ getâ‚› âŒŠ Î· âŒ‹ i â‰¡ ` (getáµ£ Î· i)
âŒŠgetâŒ‹ (Î· , j) zero    = refl
âŒŠgetâŒ‹ (Î· , j) (suc i) = âŒŠgetâŒ‹ Î· i

âŒŠwkâŒ‹ : âˆ€ {Î“ Î“â€² A} â†’ (Î· : Î“â€² âˆ‹â‹† Î“)
                  â†’ wkâ‚› {A} âŒŠ Î· âŒ‹ â‰¡ âŒŠ wkáµ£ Î· âŒ‹
âŒŠwkâŒ‹ âˆ…       = refl
âŒŠwkâŒ‹ (Î· , i) = (wkâ‚› âŒŠ Î· âŒ‹ ,_) & (` & natgetáµ£ idáµ£ i)
             â¦™ _,_ & âŒŠwkâŒ‹ Î·
                   âŠ— ` âˆ˜ suc & idgetáµ£ i

âŒŠliftâŒ‹ : âˆ€ {Î“ Î“â€² A} â†’ (Î· : Î“â€² âˆ‹â‹† Î“)
                    â†’ liftâ‚› {A} âŒŠ Î· âŒ‹ â‰¡ âŒŠ liftáµ£ Î· âŒ‹
âŒŠliftâŒ‹ Î· = (_, ` zero) & âŒŠwkâŒ‹ Î·

âŒŠidâŒ‹ : âˆ€ {Î“} â†’ idâ‚› {Î“} â‰¡ âŒŠ idáµ£ âŒ‹
âŒŠidâŒ‹ {âˆ…}     = refl
âŒŠidâŒ‹ {Î“ , A} = (_, ` zero) & ( wkâ‚› & âŒŠidâŒ‹
                             â¦™ âŒŠwkâŒ‹ idáµ£
                             )

âŒŠsubâŒ‹ : âˆ€ {Î“ Î“â€² A} â†’ (Î· : Î“â€² âˆ‹â‹† Î“) (M : Î“ âŠ¢ A)
                   â†’ sub âŒŠ Î· âŒ‹ M â‰¡ ren Î· M
âŒŠsubâŒ‹ Î· (` i)   = âŒŠgetâŒ‹ Î· i
âŒŠsubâŒ‹ Î· (Æ› M)   = Æ› & ( (Î» Ïƒ â†’ sub Ïƒ M) & âŒŠliftâŒ‹ Î·
                      â¦™ âŒŠsubâŒ‹ (liftáµ£ Î·) M
                      )
âŒŠsubâŒ‹ Î· (M âˆ™ N) = _âˆ™_ & âŒŠsubâŒ‹ Î· M
                      âŠ— âŒŠsubâŒ‹ Î· N

âŒŠâ—‹âŒ‹ : âˆ€ {Î“ Î“â€² Î“â€³} â†’ (Î·â‚ : Î“â€³ âˆ‹â‹† Î“â€²) (Î·â‚‚ : Î“â€² âˆ‹â‹† Î“)
                  â†’ âŒŠ Î·â‚ â—‹ Î·â‚‚ âŒ‹ â‰¡ âŒŠ Î·â‚ âŒ‹ â— âŒŠ Î·â‚‚ âŒ‹
âŒŠâ—‹âŒ‹ Î·â‚ âˆ…        = refl
âŒŠâ—‹âŒ‹ Î·â‚ (Î·â‚‚ , i) = _,_ & âŒŠâ—‹âŒ‹ Î·â‚ Î·â‚‚
                      âŠ— (âŒŠgetâŒ‹ Î·â‚ i â»Â¹)


--------------------------------------------------------------------------------


zapâ— : âˆ€ {Î“ Î Îâ€² A} â†’ (Ïƒ : Î“ âŠ¢â‹† Îâ€²) (Î· : Îâ€² âˆ‹â‹† Î) (M : Î“ âŠ¢ A)
                    â†’ (Ïƒ , M) â— wkáµ£ Î· â‰¡ Ïƒ â— Î·
zapâ— Ïƒ âˆ…       M = refl
zapâ— Ïƒ (Î· , i) M = (_, getâ‚› Ïƒ i) & zapâ— Ïƒ Î· M

ridâ— : âˆ€ {Î“ Î} â†’ (Ïƒ : Î“ âŠ¢â‹† Î)
               â†’ Ïƒ â— idáµ£ â‰¡ Ïƒ
ridâ— âˆ…       = refl
ridâ— (Ïƒ , M) = (_, M) & ( zapâ— Ïƒ idáµ£ M
                        â¦™ ridâ— Ïƒ
                        )


--------------------------------------------------------------------------------


getâ— : âˆ€ {Î“ Î Îâ€² A} â†’ (Ïƒ : Î“ âŠ¢â‹† Îâ€²) (Î· : Îâ€² âˆ‹â‹† Î) (i : Î âˆ‹ A)
                    â†’ getâ‚› (Ïƒ â— Î·) i â‰¡ (getâ‚› Ïƒ âˆ˜ getáµ£ Î·) i
getâ— Ïƒ (Î· , j) zero    = refl
getâ— Ïƒ (Î· , j) (suc i) = getâ— Ïƒ Î· i

wkâ— : âˆ€ {Î“ Î Îâ€² A} â†’ (Ïƒ : Î“ âŠ¢â‹† Îâ€²) (Î· : Îâ€² âˆ‹â‹† Î)
                   â†’ wkâ‚› {A} (Ïƒ â— Î·) â‰¡ wkâ‚› Ïƒ â— Î·
wkâ— Ïƒ âˆ…       = refl
wkâ— Ïƒ (Î· , i) = _,_ & wkâ— Ïƒ Î·
                    âŠ— (natgetâ‚› Ïƒ i â»Â¹)

liftâ— : âˆ€ {Î“ Î Îâ€² A} â†’ (Ïƒ : Î“ âŠ¢â‹† Îâ€²) (Î· : Îâ€² âˆ‹â‹† Î)
                     â†’ liftâ‚› {A} (Ïƒ â— Î·) â‰¡ liftâ‚› Ïƒ â— liftáµ£ Î·
liftâ— Ïƒ Î· = (_, ` zero) & ( wkâ— Ïƒ Î·
                        â¦™ zapâ— (wkâ‚› Ïƒ) Î· (` zero) â»Â¹
                        )

wkridâ— : âˆ€ {Î“ Î A} â†’ (Ïƒ : Î“ âŠ¢â‹† Î)
                   â†’ wkâ‚› {A} Ïƒ â— idáµ£ â‰¡ wkâ‚› Ïƒ
wkridâ— Ïƒ = wkâ— Ïƒ idáµ£ â»Â¹
         â¦™ wkâ‚› & ridâ— Ïƒ

liftwkridâ— : âˆ€ {Î“ Î A} â†’ (Ïƒ : Î“ âŠ¢â‹† Î)
                       â†’ liftâ‚› {A} Ïƒ â— wkáµ£ idáµ£ â‰¡ wkâ‚› Ïƒ
liftwkridâ— Ïƒ = zapâ— (wkâ‚› Ïƒ) idáµ£ (` zero)
             â¦™ wkridâ— Ïƒ

mutual
  subâ— : âˆ€ {Î“ Î Îâ€² A} â†’ (Ïƒ : Î“ âŠ¢â‹† Îâ€²) (Î· : Îâ€² âˆ‹â‹† Î) (M : Î âŠ¢ A)
                      â†’ sub (Ïƒ â— Î·) M â‰¡ (sub Ïƒ âˆ˜ ren Î·) M
  subâ— Ïƒ Î· (` i)   = getâ— Ïƒ Î· i
  subâ— Ïƒ Î· (Æ› M)   = Æ› & subliftâ— Ïƒ Î· M
  subâ— Ïƒ Î· (M âˆ™ N) = _âˆ™_ & subâ— Ïƒ Î· M
                         âŠ— subâ— Ïƒ Î· N

  subliftâ— : âˆ€ {Î“ Î Îâ€² A B} â†’ (Ïƒ : Î“ âŠ¢â‹† Îâ€²) (Î· : Îâ€² âˆ‹â‹† Î) (M : Î , B âŠ¢ A)
                            â†’ sub (liftâ‚› {B} (Ïƒ â— Î·)) M â‰¡
                               (sub (liftâ‚› Ïƒ) âˆ˜ ren (liftáµ£ Î·)) M
  subliftâ— Ïƒ Î· M = (Î» Ïƒâ€² â†’ sub Ïƒâ€² M) & liftâ— Ïƒ Î·
                 â¦™ subâ— (liftâ‚› Ïƒ) (liftáµ£ Î·) M

subwkâ— : âˆ€ {Î“ Î Îâ€² A B} â†’ (Ïƒ : Î“ âŠ¢â‹† Îâ€²) (Î· : Îâ€² âˆ‹â‹† Î) (M : Î âŠ¢ A)
                        â†’ sub (wkâ‚› {B} (Ïƒ â— Î·)) M â‰¡
                           (sub (wkâ‚› Ïƒ) âˆ˜ ren Î·) M
subwkâ— Ïƒ Î· M = (Î» Ïƒâ€² â†’ sub Ïƒâ€² M) & wkâ— Ïƒ Î·
             â¦™ subâ— (wkâ‚› Ïƒ) Î· M

subliftwkâ— : âˆ€ {Î“ Î Îâ€² A B} â†’ (Ïƒ : Î“ âŠ¢â‹† Îâ€²) (Î· : Îâ€² âˆ‹â‹† Î) (M : Î âŠ¢ A)
                            â†’ sub (wkâ‚› {B} (Ïƒ â— Î·)) M â‰¡
                               (sub (liftâ‚› Ïƒ) âˆ˜ ren (wkáµ£ Î·)) M
subliftwkâ— Ïƒ Î· M = (Î» Ïƒâ€² â†’ sub Ïƒâ€² M) & ( wkâ— Ïƒ Î·
                                        â¦™ zapâ— (wkâ‚› Ïƒ) Î· (` zero) â»Â¹
                                        )
                 â¦™ subâ— (liftâ‚› Ïƒ) (wkáµ£ Î·) M


--------------------------------------------------------------------------------


zapâ—‘ : âˆ€ {Î“ Î“â€² Î A} â†’ (Î· : Î“â€² âˆ‹â‹† Î“) (Ïƒ : Î“ âŠ¢â‹† Î) (i : Î“â€² âˆ‹ A)
                    â†’ (Î· , i) â—‘ wkâ‚› Ïƒ â‰¡ Î· â—‘ Ïƒ
zapâ—‘ Î· âˆ…       i = refl
zapâ—‘ Î· (Ïƒ , j) i = _,_ & zapâ—‘ Î· Ïƒ i
                       âŠ— ( subâ— (âŒŠ Î· âŒ‹ , ` i) (wkáµ£ idáµ£) j â»Â¹
                         â¦™ (Î» Ïƒâ€² â†’ sub Ïƒâ€² j)
                           & ( zapâ— âŒŠ Î· âŒ‹ idáµ£ (` i)
                             â¦™ ridâ— âŒŠ Î· âŒ‹
                             )
                         )

lidâ—‘ : âˆ€ {Î“ Î} â†’ (Ïƒ : Î“ âŠ¢â‹† Î)
               â†’ idáµ£ â—‘ Ïƒ â‰¡ Ïƒ
lidâ—‘ âˆ…       = refl
lidâ—‘ (Ïƒ , M) = _,_ & lidâ—‘ Ïƒ
                   âŠ— ( (Î» Ïƒâ€² â†’ sub Ïƒâ€² M) & âŒŠidâŒ‹ â»Â¹
                     â¦™ idsub M
                     )


--------------------------------------------------------------------------------


zapâ— : âˆ€ {Î“ Î Î¦ A} â†’ (Ïƒâ‚ : Î“ âŠ¢â‹† Î) (Ïƒâ‚‚ : Î âŠ¢â‹† Î¦) (M : Î“ âŠ¢ A)
                   â†’ (Ïƒâ‚ , M) â— wkâ‚› Ïƒâ‚‚ â‰¡ Ïƒâ‚ â— Ïƒâ‚‚
zapâ— Ïƒâ‚ âˆ…        M = refl
zapâ— Ïƒâ‚ (Ïƒâ‚‚ , N) M = _,_ & zapâ— Ïƒâ‚ Ïƒâ‚‚ M
                         âŠ— ( subâ— (Ïƒâ‚ , M) (wkáµ£ idáµ£) N â»Â¹
                           â¦™ (Î» Ïƒâ€² â†’ sub Ïƒâ€² N)
                             & ( zapâ— Ïƒâ‚ idáµ£ M
                               â¦™ ridâ— Ïƒâ‚
                               )
                           )

lidâ— : âˆ€ {Î“ Î} â†’ (Ïƒ : Î“ âŠ¢â‹† Î)
               â†’ idâ‚› â— Ïƒ â‰¡ Ïƒ
lidâ— âˆ…       = refl
lidâ— (Ïƒ , M) = _,_ & lidâ— Ïƒ
                   âŠ— idsub M

ridâ— : âˆ€ {Î“ Î} â†’ (Ïƒ : Î“ âŠ¢â‹† Î)
               â†’ Ïƒ â— idâ‚› â‰¡ Ïƒ
ridâ— Ïƒ = (Ïƒ â—_) & âŒŠidâŒ‹ â¦™ ridâ— Ïƒ


--------------------------------------------------------------------------------


getâ—‘ : âˆ€ {Î“ Î“â€² Î A} â†’ (Î· : Î“â€² âˆ‹â‹† Î“) (Ïƒ : Î“ âŠ¢â‹† Î) (i : Î âˆ‹ A)
                    â†’ getâ‚› (Î· â—‘ Ïƒ) i â‰¡ (ren Î· âˆ˜ getâ‚› Ïƒ) i
getâ—‘ Î· (Ïƒ , M) zero    = âŒŠsubâŒ‹ Î· M
getâ—‘ Î· (Ïƒ , M) (suc i) = getâ—‘ Î· Ïƒ i

wkâ—‘ : âˆ€ {Î“ Î“â€² Î A} â†’ (Î· : Î“â€² âˆ‹â‹† Î“) (Ïƒ : Î“ âŠ¢â‹† Î)
                   â†’ wkâ‚› {A} (Î· â—‘ Ïƒ) â‰¡ wkáµ£ Î· â—‘ Ïƒ
wkâ—‘ Î· âˆ…       = refl
wkâ—‘ Î· (Ïƒ , M) = _,_ & wkâ—‘ Î· Ïƒ
                    âŠ— ( ren (wkáµ£ idáµ£) & âŒŠsubâŒ‹ Î· M
                      â¦™ renâ—‹ (wkáµ£ idáµ£) Î· M â»Â¹
                      â¦™ (Î» Î·â€² â†’ ren Î·â€² M) & wklidâ—‹ Î·
                      â¦™ âŒŠsubâŒ‹ (wkáµ£ Î·) M â»Â¹
                      )

liftâ—‘ : âˆ€ {Î“ Î“â€² Î A} â†’ (Î· : Î“â€² âˆ‹â‹† Î“) (Ïƒ : Î“ âŠ¢â‹† Î)
                     â†’ liftâ‚› {A} (Î· â—‘ Ïƒ) â‰¡ liftáµ£ Î· â—‘ liftâ‚› Ïƒ
liftâ—‘ Î· Ïƒ = (_, ` zero) & ( wkâ—‘ Î· Ïƒ
                          â¦™ zapâ— âŒŠ wkáµ£ Î· âŒ‹ Ïƒ (` zero) â»Â¹
                          )

wklidâ—‘ : âˆ€ {Î“ Î A} â†’ (Ïƒ : Î“ âŠ¢â‹† Î)
                   â†’ wkáµ£ {A} idáµ£ â—‘ Ïƒ â‰¡ wkâ‚› Ïƒ
wklidâ—‘ Ïƒ = wkâ—‘ idáµ£ Ïƒ â»Â¹
         â¦™ wkâ‚› & lidâ—‘ Ïƒ

liftwklidâ—‘ : âˆ€ {Î“ Î A} â†’ (Ïƒ : Î“ âŠ¢â‹† Î)
                       â†’ (liftáµ£ {A} idáµ£ â—‘ wkâ‚› Ïƒ) â‰¡ wkâ‚› Ïƒ
liftwklidâ—‘ Ïƒ = zapâ—‘ (wkáµ£ idáµ£) Ïƒ zero
             â¦™ wklidâ—‘ Ïƒ

mutual
  subâ—‘ : âˆ€ {Î“ Î“â€² Î A} â†’ (Î· : Î“â€² âˆ‹â‹† Î“) (Ïƒ : Î“ âŠ¢â‹† Î) (M : Î âŠ¢ A)
                      â†’ sub (Î· â—‘ Ïƒ) M â‰¡ (ren Î· âˆ˜ sub Ïƒ) M
  subâ—‘ Î· Ïƒ (` i)   = getâ—‘ Î· Ïƒ i
  subâ—‘ Î· Ïƒ (Æ› M)   = Æ› & subliftâ—‘ Î· Ïƒ M
  subâ—‘ Î· Ïƒ (M âˆ™ N) = _âˆ™_ & subâ—‘ Î· Ïƒ M
                         âŠ— subâ—‘ Î· Ïƒ N

  subliftâ—‘ : âˆ€ {Î“ Î“â€² Î A B} â†’ (Î· : Î“â€² âˆ‹â‹† Î“) (Ïƒ : Î“ âŠ¢â‹† Î) (M : Î , B âŠ¢ A)
                            â†’ sub (liftâ‚› {B} (Î· â—‘ Ïƒ)) M â‰¡
                               (ren (liftáµ£ Î·) âˆ˜ sub (liftâ‚› Ïƒ)) M
  subliftâ—‘ Î· Ïƒ M = (Î» Ïƒâ€² â†’ sub Ïƒâ€² M) & liftâ—‘ Î· Ïƒ
                 â¦™ subâ—‘ (liftáµ£ Î·) (liftâ‚› Ïƒ) M

subwkâ—‘ : âˆ€ {Î“ Î“â€² Î A B} â†’ (Î· : Î“â€² âˆ‹â‹† Î“) (Ïƒ : Î“ âŠ¢â‹† Î) (M : Î âŠ¢ A)
                        â†’ sub (wkâ‚› {B} (Î· â—‘ Ïƒ)) M â‰¡
                           (ren (wkáµ£ Î·) âˆ˜ sub Ïƒ) M
subwkâ—‘ Î· Ïƒ M = (Î» Ïƒâ€² â†’ sub Ïƒâ€² M) & wkâ—‘ Î· Ïƒ
             â¦™ subâ—‘ (wkáµ£ Î·) Ïƒ M
subliftwkâ—‘ : âˆ€ {Î“ Î“â€² Î A B} â†’ (Î· : Î“â€² âˆ‹â‹† Î“) (Ïƒ : Î“ âŠ¢â‹† Î) (M : Î âŠ¢ A)
                            â†’ sub (wkâ‚› {B} (Î· â—‘ Ïƒ)) M â‰¡
                               (ren (liftáµ£ Î·) âˆ˜ sub (wkâ‚› Ïƒ)) M
subliftwkâ—‘ Î· Ïƒ M = (Î» Ïƒâ€² â†’ sub Ïƒâ€² M) & ( wkâ—‘ Î· Ïƒ
                                        â¦™ zapâ—‘ (wkáµ£ Î·) Ïƒ zero â»Â¹
                                        )
                 â¦™ subâ—‘ (liftáµ£ Î·) (wkâ‚› Ïƒ) M


--------------------------------------------------------------------------------


getâ— : âˆ€ {Î“ Î Î¦ A} â†’ (Ïƒâ‚ : Î“ âŠ¢â‹† Î) (Ïƒâ‚‚ : Î âŠ¢â‹† Î¦) (i : Î¦ âˆ‹ A)
                   â†’ getâ‚› (Ïƒâ‚ â— Ïƒâ‚‚) i â‰¡ (sub Ïƒâ‚ âˆ˜ getâ‚› Ïƒâ‚‚) i
getâ— Ïƒâ‚ (Ïƒâ‚‚ , M) zero    = refl
getâ— Ïƒâ‚ (Ïƒâ‚‚ , M) (suc i) = getâ— Ïƒâ‚ Ïƒâ‚‚ i

wkâ— : âˆ€ {Î“ Î Î¦ A} â†’ (Ïƒâ‚ : Î“ âŠ¢â‹† Î) (Ïƒâ‚‚ : Î âŠ¢â‹† Î¦)
                  â†’ wkâ‚› {A} (Ïƒâ‚ â— Ïƒâ‚‚) â‰¡ wkâ‚› Ïƒâ‚ â— Ïƒâ‚‚
wkâ— Ïƒâ‚ âˆ…        = refl
wkâ— Ïƒâ‚ (Ïƒâ‚‚ , M) = _,_ & wkâ— Ïƒâ‚ Ïƒâ‚‚
                      âŠ— ( subâ—‘ (wkáµ£ idáµ£) Ïƒâ‚ M â»Â¹
                        â¦™ (Î» Ïƒâ€² â†’ sub Ïƒâ€² M) & wklidâ—‘ Ïƒâ‚
                        )

liftâ— : âˆ€ {Î“ Î Î¦ A} â†’ (Ïƒâ‚ : Î“ âŠ¢â‹† Î) (Ïƒâ‚‚ : Î âŠ¢â‹† Î¦)
                    â†’ liftâ‚› {A} (Ïƒâ‚ â— Ïƒâ‚‚) â‰¡ liftâ‚› Ïƒâ‚ â— liftâ‚› Ïƒâ‚‚
liftâ— Ïƒâ‚ Ïƒâ‚‚ = (_, ` zero) & ( wkâ— Ïƒâ‚ Ïƒâ‚‚
                            â¦™ zapâ— (wkâ‚› Ïƒâ‚) Ïƒâ‚‚ (` zero) â»Â¹
                            )

wklidâ— : âˆ€ {Î“ Î A} â†’ (Ïƒ : Î“ âŠ¢â‹† Î)
                   â†’ wkâ‚› {A} idâ‚› â— Ïƒ â‰¡ wkâ‚› Ïƒ
wklidâ— Ïƒ = wkâ— idâ‚› Ïƒ â»Â¹
         â¦™ wkâ‚› & lidâ— Ïƒ

wkridâ— : âˆ€ {Î“ Î A} â†’ (Ïƒ : Î“ âŠ¢â‹† Î)
                   â†’ wkâ‚› {A} Ïƒ â— idâ‚› â‰¡ wkâ‚› Ïƒ
wkridâ— Ïƒ = wkâ— Ïƒ idâ‚› â»Â¹
         â¦™ wkâ‚› & ridâ— Ïƒ

liftwkridâ— : âˆ€ {Î“ Î A} â†’ (Ïƒ : Î“ âŠ¢â‹† Î)
                       â†’ liftâ‚› {A} Ïƒ â— wkâ‚› idâ‚› â‰¡ wkâ‚› Ïƒ
liftwkridâ— Ïƒ = zapâ— (wkâ‚› Ïƒ) idâ‚› (` zero)
             â¦™ wkridâ— Ïƒ

mutual
  subâ— : âˆ€ {Î“ Î Î¦ A} â†’ (Ïƒâ‚ : Î“ âŠ¢â‹† Î) (Ïƒâ‚‚ : Î âŠ¢â‹† Î¦) (M : Î¦ âŠ¢ A)
                     â†’ sub (Ïƒâ‚ â— Ïƒâ‚‚) M â‰¡ (sub Ïƒâ‚ âˆ˜ sub Ïƒâ‚‚) M
  subâ— Ïƒâ‚ Ïƒâ‚‚ (` i)   = getâ— Ïƒâ‚ Ïƒâ‚‚ i
  subâ— Ïƒâ‚ Ïƒâ‚‚ (Æ› M)   = Æ› & subliftâ— Ïƒâ‚ Ïƒâ‚‚ M
  subâ— Ïƒâ‚ Ïƒâ‚‚ (M âˆ™ N) = _âˆ™_ & subâ— Ïƒâ‚ Ïƒâ‚‚ M
                           âŠ— subâ— Ïƒâ‚ Ïƒâ‚‚ N

  subliftâ— : âˆ€ {Î“ Î Î¦ A B} â†’ (Ïƒâ‚ : Î“ âŠ¢â‹† Î) (Ïƒâ‚‚ : Î âŠ¢â‹† Î¦) (M : Î¦ , B âŠ¢ A)
                           â†’ sub (liftâ‚› {B} (Ïƒâ‚ â— Ïƒâ‚‚)) M â‰¡
                              (sub (liftâ‚› Ïƒâ‚) âˆ˜ sub (liftâ‚› Ïƒâ‚‚)) M
  subliftâ— Ïƒâ‚ Ïƒâ‚‚ M = (Î» Ïƒâ€² â†’ sub Ïƒâ€² M) & liftâ— Ïƒâ‚ Ïƒâ‚‚
                   â¦™ subâ— (liftâ‚› Ïƒâ‚) (liftâ‚› Ïƒâ‚‚) M

subwkâ— : âˆ€ {Î“ Î Î¦ A B} â†’ (Ïƒâ‚ : Î“ âŠ¢â‹† Î) (Ïƒâ‚‚ : Î âŠ¢â‹† Î¦) (M : Î¦ âŠ¢ A)
                       â†’ sub (wkâ‚› {B} (Ïƒâ‚ â— Ïƒâ‚‚)) M â‰¡
                          (sub (wkâ‚› Ïƒâ‚) âˆ˜ sub Ïƒâ‚‚) M
subwkâ— Ïƒâ‚ Ïƒâ‚‚ M = (Î» Ïƒâ€² â†’ sub Ïƒâ€² M) & wkâ— Ïƒâ‚ Ïƒâ‚‚
               â¦™ subâ— (wkâ‚› Ïƒâ‚) Ïƒâ‚‚ M

subliftwkâ— : âˆ€ {Î“ Î Î¦ A B} â†’ (Ïƒâ‚ : Î“ âŠ¢â‹† Î) (Ïƒâ‚‚ : Î âŠ¢â‹† Î¦) (M : Î¦ âŠ¢ A)
                           â†’ sub (wkâ‚› {B} (Ïƒâ‚ â— Ïƒâ‚‚)) M â‰¡
                              (sub (liftâ‚› Ïƒâ‚) âˆ˜ sub (wkâ‚› Ïƒâ‚‚)) M
subliftwkâ— Ïƒâ‚ Ïƒâ‚‚ M = (Î» Ïƒâ€² â†’ sub Ïƒâ€² M) & ( wkâ— Ïƒâ‚ Ïƒâ‚‚
                                          â¦™ zapâ— (wkâ‚› Ïƒâ‚) Ïƒâ‚‚ (` zero) â»Â¹
                                          )
                   â¦™ subâ— (liftâ‚› Ïƒâ‚) (wkâ‚› Ïƒâ‚‚) M


--------------------------------------------------------------------------------


compâ—â—‹ : âˆ€ {Î“ Î Îâ€² Îâ€³} â†’ (Ïƒ : Î“ âŠ¢â‹† Îâ€³) (Î·â‚ : Îâ€³ âˆ‹â‹† Îâ€²) (Î·â‚‚ : Îâ€² âˆ‹â‹† Î)
                       â†’ Ïƒ â— (Î·â‚ â—‹ Î·â‚‚) â‰¡ (Ïƒ â— Î·â‚) â— Î·â‚‚
compâ—â—‹ Ïƒ Î·â‚ âˆ…        = refl
compâ—â—‹ Ïƒ Î·â‚ (Î·â‚‚ , i) = _,_ & compâ—â—‹ Ïƒ Î·â‚ Î·â‚‚
                           âŠ— (getâ— Ïƒ Î·â‚ i â»Â¹)


compâ—‘â—‹ : âˆ€ {Î“ Î“â€² Î“â€³ Î} â†’ (Î·â‚ : Î“â€³ âˆ‹â‹† Î“â€²) (Î·â‚‚ : Î“â€² âˆ‹â‹† Î“) (Ïƒ : Î“ âŠ¢â‹† Î)
                       â†’ Î·â‚ â—‘ (Î·â‚‚ â—‘ Ïƒ) â‰¡ (Î·â‚ â—‹ Î·â‚‚) â—‘ Ïƒ
compâ—‘â—‹ Î·â‚ Î·â‚‚ âˆ…       = refl
compâ—‘â—‹ Î·â‚ Î·â‚‚ (Ïƒ , M) = _,_ & compâ—‘â—‹ Î·â‚ Î·â‚‚ Ïƒ
                           âŠ— ( subâ— âŒŠ Î·â‚ âŒ‹ âŒŠ Î·â‚‚ âŒ‹ M â»Â¹
                             â¦™ (Î» Ïƒâ€² â†’ sub Ïƒâ€² M)
                               & âŒŠâ—‹âŒ‹ Î·â‚ Î·â‚‚ â»Â¹
                             )

compâ—‘â— : âˆ€ {Î“ Î“â€² Î Îâ€²} â†’ (Î·â‚ : Î“â€² âˆ‹â‹† Î“) (Ïƒ : Î“ âŠ¢â‹† Îâ€²) (Î·â‚‚ : Îâ€² âˆ‹â‹† Î)
                       â†’ Î·â‚ â—‘ (Ïƒ â— Î·â‚‚) â‰¡ (Î·â‚ â—‘ Ïƒ) â— Î·â‚‚
compâ—‘â— Î·â‚ Ïƒ âˆ…        = refl
compâ—‘â— Î·â‚ Ïƒ (Î·â‚‚ , i) = _,_ & compâ—‘â— Î·â‚ Ïƒ Î·â‚‚
                           âŠ— ( âŒŠsubâŒ‹ Î·â‚ (getâ‚› Ïƒ i)
                             â¦™ getâ—‘ Î·â‚ Ïƒ i â»Â¹
                             )

compâ—‘â— : âˆ€ {Î“ Î“â€² Î Î¦} â†’ (Î· : Î“â€² âˆ‹â‹† Î“) (Ïƒâ‚ : Î“ âŠ¢â‹† Î) (Ïƒâ‚‚ : Î âŠ¢â‹† Î¦)
                      â†’ Î· â—‘ (Ïƒâ‚ â— Ïƒâ‚‚) â‰¡ (Î· â—‘ Ïƒâ‚) â— Ïƒâ‚‚
compâ—‘â— Î· Ïƒâ‚ âˆ…        = refl
compâ—‘â— Î· Ïƒâ‚ (Ïƒâ‚‚ , M) = _,_ & compâ—‘â— Î· Ïƒâ‚ Ïƒâ‚‚
                           âŠ— (subâ— âŒŠ Î· âŒ‹ Ïƒâ‚ M â»Â¹)


compâ—â— : âˆ€ {Î“ Î Î¦ Î¦â€²} â†’ (Ïƒâ‚ : Î“ âŠ¢â‹† Î) (Ïƒâ‚‚ : Î âŠ¢â‹† Î¦â€²) (Î· : Î¦â€² âˆ‹â‹† Î¦)
                      â†’ Ïƒâ‚ â— (Ïƒâ‚‚ â— Î·) â‰¡ (Ïƒâ‚ â— Ïƒâ‚‚) â— Î·
compâ—â— Ïƒâ‚ Ïƒâ‚‚ âˆ…       = refl
compâ—â— Ïƒâ‚ Ïƒâ‚‚ (Î· , i) = _,_ & compâ—â— Ïƒâ‚ Ïƒâ‚‚ Î·
                           âŠ— (getâ— Ïƒâ‚ Ïƒâ‚‚ i â»Â¹)

compâ—â—‘ : âˆ€ {Î“ Î Îâ€² Î¦} â†’ (Ïƒâ‚ : Î“ âŠ¢â‹† Îâ€²) (Î· : Îâ€² âˆ‹â‹† Î) (Ïƒâ‚‚ : Î âŠ¢â‹† Î¦)
                      â†’ Ïƒâ‚ â— (Î· â—‘ Ïƒâ‚‚) â‰¡ (Ïƒâ‚ â— Î·) â— Ïƒâ‚‚
compâ—â—‘ Ïƒâ‚ Î· âˆ…        = refl
compâ—â—‘ Ïƒâ‚ Î· (Ïƒâ‚‚ , M) = _,_ & compâ—â—‘ Ïƒâ‚ Î· Ïƒâ‚‚
                           âŠ— (subâ— Ïƒâ‚ âŒŠ Î· âŒ‹ M â»Â¹)


--------------------------------------------------------------------------------


assocâ— : âˆ€ {Î“ Î Î¦ Î¨} â†’ (Ïƒâ‚ : Î“ âŠ¢â‹† Î) (Ïƒâ‚‚ : Î âŠ¢â‹† Î¦) (Ïƒâ‚ƒ : Î¦ âŠ¢â‹† Î¨)
                     â†’ Ïƒâ‚ â— (Ïƒâ‚‚ â— Ïƒâ‚ƒ) â‰¡ (Ïƒâ‚ â— Ïƒâ‚‚) â— Ïƒâ‚ƒ
assocâ— Ïƒâ‚ Ïƒâ‚‚ âˆ…        = refl
assocâ— Ïƒâ‚ Ïƒâ‚‚ (Ïƒâ‚ƒ , M) = _,_ & assocâ— Ïƒâ‚ Ïƒâ‚‚ Ïƒâ‚ƒ
                            âŠ— (subâ— Ïƒâ‚ Ïƒâ‚‚ M â»Â¹)


--------------------------------------------------------------------------------


ğ—¦ğ—§ğ—Ÿğ—– : Category ğ’ _âŠ¢â‹†_
ğ—¦ğ—§ğ—Ÿğ—– =
  record
    { idâ‚“    = idâ‚›
    ; _â‹„_    = flip _â—_
    ; lidâ‹„   = ridâ—
    ; ridâ‹„   = lidâ—
    ; assocâ‹„ = assocâ—
    }


subPsh : ğ’¯ â†’ Presheafâ‚€ ğ—¦ğ—§ğ—Ÿğ—–
subPsh A =
  record
    { Fâ‚“   = _âŠ¢ A
    ; Fâ‚˜   = sub
    ; idFâ‚˜ = fext! idsub
    ; Fâ‚˜â‹„  = Î» Ïƒâ‚ Ïƒâ‚‚ â†’ fext! (subâ— Ïƒâ‚‚ Ïƒâ‚)
    }


--------------------------------------------------------------------------------
