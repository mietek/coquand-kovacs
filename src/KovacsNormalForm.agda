module KovacsNormalForm where

open import KovacsEmbedding public
open import Category


--------------------------------------------------------------------------------


mutual
  -- (Nfâ‚‘)
  renâ¿á¶  : âˆ€ {Î“ Î“â€² A} â†’ Î“â€² âŠ‡ Î“ â†’ Î“ âŠ¢â¿á¶  A â†’ Î“â€² âŠ¢â¿á¶  A
  renâ¿á¶  Î· (Æ› M)  = Æ› (renâ¿á¶  (liftâ‚‘ Î·) M)
  renâ¿á¶  Î· (ne M) = ne (renâ¿áµ‰ Î· M)

  -- (Neâ‚‘)
  renâ¿áµ‰ : âˆ€ {Î“ Î“â€² A} â†’ Î“â€² âŠ‡ Î“ â†’ Î“ âŠ¢â¿áµ‰ A â†’ Î“â€² âŠ¢â¿áµ‰ A
  renâ¿áµ‰ Î· (` i)   = ` (getâ‚‘ Î· i)
  renâ¿áµ‰ Î· (M âˆ™ N) = renâ¿áµ‰ Î· M âˆ™ renâ¿á¶  Î· N


mutual
  -- (Nf-idâ‚‘)
  idrenâ¿á¶  : âˆ€ {Î“ A} â†’ (M : Î“ âŠ¢â¿á¶  A)
                    â†’ renâ¿á¶  idâ‚‘ M â‰¡ M
  idrenâ¿á¶  (Æ› M)  = Æ› & idrenâ¿á¶  M
  idrenâ¿á¶  (ne M) = ne & idrenâ¿áµ‰ M

  -- (Ne-idâ‚‘)
  idrenâ¿áµ‰ : âˆ€ {Î“ A} â†’ (M : Î“ âŠ¢â¿áµ‰ A)
                    â†’ renâ¿áµ‰ idâ‚‘ M â‰¡ M
  idrenâ¿áµ‰ (` i)   = ` & idgetâ‚‘ i
  idrenâ¿áµ‰ (M âˆ™ N) = _âˆ™_ & idrenâ¿áµ‰ M
                        âŠ— idrenâ¿á¶  N


mutual
  -- (Nf-âˆ˜â‚‘)
  renâ¿á¶ â—‹ : âˆ€ {Î“ Î“â€² Î“â€³ A} â†’ (Î·â‚ : Î“â€³ âŠ‡ Î“â€²) (Î·â‚‚ : Î“â€² âŠ‡ Î“) (M : Î“ âŠ¢â¿á¶  A)
                         â†’ renâ¿á¶  (Î·â‚‚ â—‹ Î·â‚) M â‰¡ (renâ¿á¶  Î·â‚ âˆ˜ renâ¿á¶  Î·â‚‚) M
  renâ¿á¶ â—‹ Î·â‚ Î·â‚‚ (Æ› M)  = Æ› & renâ¿á¶ â—‹ (liftâ‚‘ Î·â‚) (liftâ‚‘ Î·â‚‚) M
  renâ¿á¶ â—‹ Î·â‚ Î·â‚‚ (ne M) = ne & renâ¿áµ‰â—‹ Î·â‚ Î·â‚‚ M

  -- (Ne-âˆ˜â‚‘)
  renâ¿áµ‰â—‹ : âˆ€ {Î“ Î“â€² Î“â€³ A} â†’ (Î·â‚ : Î“â€³ âŠ‡ Î“â€²) (Î·â‚‚ : Î“â€² âŠ‡ Î“) (M : Î“ âŠ¢â¿áµ‰ A)
                         â†’ renâ¿áµ‰ (Î·â‚‚ â—‹ Î·â‚) M â‰¡ (renâ¿áµ‰ Î·â‚ âˆ˜ renâ¿áµ‰ Î·â‚‚) M
  renâ¿áµ‰â—‹ Î·â‚ Î·â‚‚ (` i)   = ` & getâ—‹ Î·â‚ Î·â‚‚ i
  renâ¿áµ‰â—‹ Î·â‚ Î·â‚‚ (M âˆ™ N) = _âˆ™_ & renâ¿áµ‰â—‹ Î·â‚ Î·â‚‚ M
                             âŠ— renâ¿á¶ â—‹ Î·â‚ Î·â‚‚ N


mutual
  -- (âŒœ_âŒNf)
  embâ¿á¶  : âˆ€ {Î“ A} â†’ Î“ âŠ¢â¿á¶  A â†’ Î“ âŠ¢ A
  embâ¿á¶  (Æ› M)  = Æ› (embâ¿á¶  M)
  embâ¿á¶  (ne M) = embâ¿áµ‰ M

  -- (âŒœ_âŒNe)
  embâ¿áµ‰ : âˆ€ {Î“ A} â†’ Î“ âŠ¢â¿áµ‰ A â†’ Î“ âŠ¢ A
  embâ¿áµ‰ (` i)   = ` i
  embâ¿áµ‰ (M âˆ™ N) = embâ¿áµ‰ M âˆ™ embâ¿á¶  N


mutual
  -- (âŒœâŒNf-nat)
  natembâ¿á¶  : âˆ€ {A Î“ Î“â€²} â†’ (Î· : Î“â€² âŠ‡ Î“) (M : Î“ âŠ¢â¿á¶  A)
                        â†’ (embâ¿á¶  âˆ˜ renâ¿á¶  Î·) M â‰¡ (ren Î· âˆ˜ embâ¿á¶ ) M
  natembâ¿á¶  Î· (Æ› M)  = Æ› & natembâ¿á¶  (liftâ‚‘ Î·) M
  natembâ¿á¶  Î· (ne M) = natembâ¿áµ‰ Î· M

  -- (âŒœâŒNe-nat)
  natembâ¿áµ‰ : âˆ€ {A Î“ Î“â€²} â†’ (Î· : Î“â€² âŠ‡ Î“) (M : Î“ âŠ¢â¿áµ‰ A)
                        â†’ (embâ¿áµ‰ âˆ˜ renâ¿áµ‰ Î·) M â‰¡ (ren Î· âˆ˜ embâ¿áµ‰) M
  natembâ¿áµ‰ Î· (` i)   = refl
  natembâ¿áµ‰ Î· (M âˆ™ N) = _âˆ™_ & natembâ¿áµ‰ Î· M
                           âŠ— natembâ¿á¶  Î· N


--------------------------------------------------------------------------------


renâ¿á¶ Psh : ğ’¯ â†’ Presheafâ‚€ ğ—¢ğ—£ğ—˜
renâ¿á¶ Psh A =
  record
    { Ï†â‚“   = _âŠ¢â¿á¶  A
    ; Ï†â‚˜   = renâ¿á¶ 
    ; idÏ†â‚˜ = fext! idrenâ¿á¶ 
    ; Ï†â‚˜â‹„  = Î» Î·â‚ Î·â‚‚ â†’ fext! (renâ¿á¶ â—‹ Î·â‚‚ Î·â‚)
    }

renâ¿áµ‰Psh : ğ’¯ â†’ Presheafâ‚€ ğ—¢ğ—£ğ—˜
renâ¿áµ‰Psh A =
  record
    { Ï†â‚“   = _âŠ¢â¿áµ‰ A
    ; Ï†â‚˜   = renâ¿áµ‰
    ; idÏ†â‚˜ = fext! idrenâ¿áµ‰
    ; Ï†â‚˜â‹„  = Î» Î·â‚ Î·â‚‚ â†’ fext! (renâ¿áµ‰â—‹ Î·â‚‚ Î·â‚)
    }


embâ¿á¶ NT : âˆ€ {A} â†’ NaturalTransformation (renâ¿á¶ Psh A) (renPsh A)
embâ¿á¶ NT =
  record
    { Ï•    = embâ¿á¶ 
    ; natÏ• = Î» Î· â†’ fext! (Î» M â†’ natembâ¿á¶  Î· M)
    }

embâ¿áµ‰NT : âˆ€ {A} â†’ NaturalTransformation (renâ¿áµ‰Psh A) (renPsh A)
embâ¿áµ‰NT =
  record
    { Ï•    = embâ¿áµ‰
    ; natÏ• = Î» Î· â†’ fext! (Î» M â†’ natembâ¿áµ‰ Î· M)
    }


--------------------------------------------------------------------------------
