{-# OPTIONS --no-positivity-check #-}

module STLC.Coquand.Completeness where

open import STLC.Coquand.Normalisation public
open import STLC.Coquand.Convertibility public


--------------------------------------------------------------------------------


data CV : âˆ€ {Î“ A} â†’ Î“ âŠ¢ A â†’ Î“ âŠ© A â†’ Set
  where
    cvâµ : âˆ€ {Î“} â†’ {M : Î“ âŠ¢ âµ} {f : Î“ âŠ© âµ}
                â†’ (h : âˆ€ {Î“â€²} â†’ (Î· : Î“â€² âˆ‹â‹† Î“)
                               â†’ sub âŒŠ Î· âŒ‹ M âˆ¼ âŸ¦gâŸ§âŸ¨ Î· âŸ© f)
                â†’ CV M f

    cvâŠƒ : âˆ€ {Î“ A B} â†’ {M : Î“ âŠ¢ A â‡’ B} {f : Î“ âŠ© A â‡’ B}
                    â†’ (h : âˆ€ {Î“â€² N a} â†’ (Î· : Î“â€² âˆ‹â‹† Î“) â†’ CV N a
                                       â†’ CV (sub âŒŠ Î· âŒ‹ M âˆ™ N) (f âŸ¦âˆ™âŸ§âŸ¨ Î· âŸ© a))
                    â†’ CV M f


data CVâ‹† : âˆ€ {Î“ Î} â†’ Î“ âŠ¢â‹† Î â†’ Î“ âŠ©â‹† Î â†’ Set
  where
    âˆ…   : âˆ€ {Î“} â†’ {Ïƒ : Î“ âŠ¢â‹† âˆ…}
                â†’ CVâ‹† Ïƒ âˆ…

    _,_ : âˆ€ {Î“ Î A} â†’ {Ïƒ : Î“ âŠ¢â‹† Î , A} {Ï : Î“ âŠ©â‹† Î} {a : Î“ âŠ© A}
                    â†’ (Îº : CVâ‹† (Ïƒ â— wkáµ£ {A} idáµ£) Ï) (k : CV (sub Ïƒ 0) a)
                    â†’ CVâ‹† Ïƒ (Ï , a)


--------------------------------------------------------------------------------


postulate
  congCV : âˆ€ {Î“ A} â†’ {Mâ‚ Mâ‚‚ : Î“ âŠ¢ A} {a : Î“ âŠ© A}
                   â†’ Mâ‚ âˆ¼ Mâ‚‚ â†’ CV Mâ‚ a
                   â†’ CV Mâ‚‚ a

-- (congâ†‘âŸ¨_âŸ©CV)
postulate
  accCV : âˆ€ {Î“ Î“â€² A} â†’ {M : Î“ âŠ¢ A} {a : Î“ âŠ© A}
                     â†’ (Î· : Î“â€² âˆ‹â‹† Î“) â†’ CV M a
                     â†’ CV (sub âŒŠ Î· âŒ‹ M) (acc Î· a)

-- (conglookupCV)
postulate
  getCV : âˆ€ {Î“ Î A} â†’ {Ïƒ : Î“ âŠ¢â‹† Î} {Ï : Î“ âŠ©â‹† Î}
                    â†’ (i : Î âˆ‹ A) â†’ CVâ‹† Ïƒ Ï
                    â†’ CV (sub Ïƒ (ğ“‹ i)) (getáµ¥ Ï i)

-- (congâ†‘âŸ¨_âŸ©CVâ‹†)
postulate
  accCVâ‹† : âˆ€ {Î“ Î“â€² Î} â†’ {Ïƒ : Î“ âŠ¢â‹† Î} {Ï : Î“ âŠ©â‹† Î}
                      â†’ (Î· : Î“â€² âˆ‹â‹† Î“) â†’ CVâ‹† Ïƒ Ï
                      â†’ CVâ‹† (Î· â—‘ Ïƒ) (Î· â¬— Ï)

-- (congâ†“âŸ¨_âŸ©CVâ‹†)
postulate
  getCVâ‹† : âˆ€ {Î“ Î Îâ€²} â†’ {Ïƒ : Î“ âŠ¢â‹† Îâ€²} {Ï : Î“ âŠ©â‹† Îâ€²}
                      â†’ (Î· : Îâ€² âˆ‹â‹† Î) â†’ CVâ‹† Ïƒ Ï
                      â†’ CVâ‹† (Ïƒ â— Î·) (Ï â¬– Î·)


--------------------------------------------------------------------------------


-- Lemma 8.
postulate
  âŸ¦_âŸ§CV : âˆ€ {Î“ Î A} â†’ {Ïƒ : Î“ âŠ¢â‹† Î} {Ï : Î“ âŠ©â‹† Î}
                    â†’ (M : Î âŠ¢ A) â†’ CVâ‹† Ïƒ Ï
                    â†’ CV (sub Ïƒ M) (âŸ¦ M âŸ§ Ï)

postulate
  âŸ¦_âŸ§CVâ‹† : âˆ€ {Î“ Î Î¦} â†’ {Ïƒâ‚ : Î“ âŠ¢â‹† Î} {Ï : Î“ âŠ©â‹† Î}
                     â†’ (Ïƒâ‚‚ : Î âŠ¢â‹† Î¦) â†’ CVâ‹† Ïƒâ‚ Ï
                     â†’ CVâ‹† (Ïƒâ‚ â— Ïƒâ‚‚) (âŸ¦ Ïƒâ‚‚ âŸ§â‹† Ï)


--------------------------------------------------------------------------------


-- Lemma 9.
mutual
  postulate
    lemâ‚‰ : âˆ€ {Î“ A} â†’ {M : Î“ âŠ¢ A} {a : Î“ âŠ© A}
                   â†’ CV M a
                   â†’ M âˆ¼ reify a

  postulate
    auxâ‚„â‚†â‚ˆ : âˆ€ {A Î“} â†’ {M : Î“ âŠ¢ A} {f : âˆ€ {Î“â€²} â†’ Î“â€² âˆ‹â‹† Î“ â†’ Î“â€² âŠ¢ A}
                     â†’ (âˆ€ {Î“â€²} â†’ (Î· : Î“â€² âˆ‹â‹† Î“) â†’ sub âŒŠ Î· âŒ‹ M âˆ¼ f Î·)
                     â†’ CV M (âŸª f âŸ«)

postulate
  âŒŠ_âŒ‹CVâ‹† : âˆ€ {Î“ Î“â€²} â†’ (Î· : Î“â€² âˆ‹â‹† Î“)
                   â†’ CVâ‹† âŒŠ Î· âŒ‹ âŒŠ Î· âŒ‹áµ¥

idCVâ‹† : âˆ€ {Î“} â†’ CVâ‹† âŒŠ idáµ£ âŒ‹ (idáµ¥ {Î“})
idCVâ‹† = âŒŠ idáµ£ âŒ‹CVâ‹†

postulate
  auxâ‚„â‚†â‚‰ : âˆ€ {Î“ A} â†’ (M : Î“ âŠ¢ A)
                   â†’ sub âŒŠ idáµ£ âŒ‹ M âˆ¼ nf M


--------------------------------------------------------------------------------


-- Theorem 2.
postulate
  thmâ‚‚ : âˆ€ {Î“ A} â†’ (M : Î“ âŠ¢ A)
                 â†’ M âˆ¼ nf M

-- Theorem 3.
thmâ‚ƒ : âˆ€ {Î“ A} â†’ (Mâ‚ Mâ‚‚ : Î“ âŠ¢ A) â†’ Eq (âŸ¦ Mâ‚ âŸ§ idáµ¥) (âŸ¦ Mâ‚‚ âŸ§ idáµ¥)
               â†’ Mâ‚ âˆ¼ Mâ‚‚
thmâ‚ƒ Mâ‚ Mâ‚‚ e = thmâ‚‚ Mâ‚
             â¦™ â‰¡â†’âˆ¼ (corâ‚ Mâ‚ Mâ‚‚ e)
             â¦™ thmâ‚‚ Mâ‚‚ â»Â¹


--------------------------------------------------------------------------------
