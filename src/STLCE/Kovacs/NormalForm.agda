module STLCE.Kovacs.NormalForm where

open import STLCE.Kovacs.Embedding public
open import Category


--------------------------------------------------------------------------------


mutual
  -- (Nfâ‚‘)
  renâ¿á¶  : âˆ€ {Î“ Î“â€² A} â†’ Î“â€² âŠ‡ Î“ â†’ Î“ âŠ¢â¿á¶  A â†’ Î“â€² âŠ¢â¿á¶  A
  renâ¿á¶  Î· (Æ› M)   = Æ› (renâ¿á¶  (liftâ‚‘ Î·) M)
  renâ¿á¶  Î· (M , N) = renâ¿á¶  Î· M , renâ¿á¶  Î· N
  renâ¿á¶  Î· Ï„       = Ï„
  renâ¿á¶  Î· (Î¹â‚ M)  = Î¹â‚ (renâ¿á¶  Î· M)
  renâ¿á¶  Î· (Î¹â‚‚ M)  = Î¹â‚‚ (renâ¿á¶  Î· M)
  renâ¿á¶  Î· (ne M)  = ne (renâ¿áµ‰ Î· M)

  -- (Neâ‚‘)
  renâ¿áµ‰ : âˆ€ {Î“ Î“â€² A} â†’ Î“â€² âŠ‡ Î“ â†’ Î“ âŠ¢â¿áµ‰ A â†’ Î“â€² âŠ¢â¿áµ‰ A
  renâ¿áµ‰ Î· (` i)         = ` (getâ‚‘ Î· i)
  renâ¿áµ‰ Î· (M âˆ™ N)       = renâ¿áµ‰ Î· M âˆ™ renâ¿á¶  Î· N
  renâ¿áµ‰ Î· (Ï€â‚ M)        = Ï€â‚ (renâ¿áµ‰ Î· M)
  renâ¿áµ‰ Î· (Ï€â‚‚ M)        = Ï€â‚‚ (renâ¿áµ‰ Î· M)
  renâ¿áµ‰ Î· (Ï† M)         = Ï† (renâ¿áµ‰ Î· M)
  renâ¿áµ‰ Î· (M â‡ Nâ‚ âˆ¥ Nâ‚‚) = renâ¿áµ‰ Î· M â‡ renâ¿á¶  (liftâ‚‘ Î·) Nâ‚
                                    âˆ¥ renâ¿á¶  (liftâ‚‘ Î·) Nâ‚‚


mutual
  -- (Nf-idâ‚‘)
  idrenâ¿á¶  : âˆ€ {Î“ A} â†’ (M : Î“ âŠ¢â¿á¶  A)
                    â†’ renâ¿á¶  idâ‚‘ M â‰¡ M
  idrenâ¿á¶  (Æ› M)   = Æ› & idrenâ¿á¶  M
  idrenâ¿á¶  (M , N) = _,_ & idrenâ¿á¶  M âŠ— idrenâ¿á¶  N
  idrenâ¿á¶  Ï„       = refl
  idrenâ¿á¶  (Î¹â‚ M)  = Î¹â‚ & idrenâ¿á¶  M
  idrenâ¿á¶  (Î¹â‚‚ M)  = Î¹â‚‚ & idrenâ¿á¶  M
  idrenâ¿á¶  (ne M)  = ne & idrenâ¿áµ‰ M

  -- (Ne-idâ‚‘)
  idrenâ¿áµ‰ : âˆ€ {Î“ A} â†’ (M : Î“ âŠ¢â¿áµ‰ A)
                    â†’ renâ¿áµ‰ idâ‚‘ M â‰¡ M
  idrenâ¿áµ‰ (` i)         = ` & idgetâ‚‘ i
  idrenâ¿áµ‰ (M âˆ™ N)       = _âˆ™_ & idrenâ¿áµ‰ M
                              âŠ— idrenâ¿á¶  N
  idrenâ¿áµ‰ (Ï€â‚ M)        = Ï€â‚ & idrenâ¿áµ‰ M
  idrenâ¿áµ‰ (Ï€â‚‚ M)        = Ï€â‚‚ & idrenâ¿áµ‰ M
  idrenâ¿áµ‰ (Ï† M)         = Ï† & idrenâ¿áµ‰ M
  idrenâ¿áµ‰ (M â‡ Nâ‚ âˆ¥ Nâ‚‚) = _â‡_âˆ¥_ & idrenâ¿áµ‰ M
                                âŠ— idrenâ¿á¶  Nâ‚
                                âŠ— idrenâ¿á¶  Nâ‚‚


mutual
  -- (Nf-âˆ˜â‚‘)
  renâ¿á¶ â—‹ : âˆ€ {Î“ Î“â€² Î“â€³ A} â†’ (Î·â‚ : Î“â€³ âŠ‡ Î“â€²) (Î·â‚‚ : Î“â€² âŠ‡ Î“) (M : Î“ âŠ¢â¿á¶  A)
                         â†’ renâ¿á¶  (Î·â‚‚ â—‹ Î·â‚) M â‰¡ (renâ¿á¶  Î·â‚ âˆ˜ renâ¿á¶  Î·â‚‚) M
  renâ¿á¶ â—‹ Î·â‚ Î·â‚‚ (Æ› M)   = Æ› & renâ¿á¶ â—‹ (liftâ‚‘ Î·â‚) (liftâ‚‘ Î·â‚‚) M
  renâ¿á¶ â—‹ Î·â‚ Î·â‚‚ (M , N) = _,_ & renâ¿á¶ â—‹ Î·â‚ Î·â‚‚ M
                             âŠ— renâ¿á¶ â—‹ Î·â‚ Î·â‚‚ N
  renâ¿á¶ â—‹ Î·â‚ Î·â‚‚ Ï„       = refl
  renâ¿á¶ â—‹ Î·â‚ Î·â‚‚ (Î¹â‚ M)  = Î¹â‚ & renâ¿á¶ â—‹ Î·â‚ Î·â‚‚ M
  renâ¿á¶ â—‹ Î·â‚ Î·â‚‚ (Î¹â‚‚ M)  = Î¹â‚‚ & renâ¿á¶ â—‹ Î·â‚ Î·â‚‚ M
  renâ¿á¶ â—‹ Î·â‚ Î·â‚‚ (ne M)  = ne & renâ¿áµ‰â—‹ Î·â‚ Î·â‚‚ M

  -- (Ne-âˆ˜â‚‘)
  renâ¿áµ‰â—‹ : âˆ€ {Î“ Î“â€² Î“â€³ A} â†’ (Î·â‚ : Î“â€³ âŠ‡ Î“â€²) (Î·â‚‚ : Î“â€² âŠ‡ Î“) (M : Î“ âŠ¢â¿áµ‰ A)
                         â†’ renâ¿áµ‰ (Î·â‚‚ â—‹ Î·â‚) M â‰¡ (renâ¿áµ‰ Î·â‚ âˆ˜ renâ¿áµ‰ Î·â‚‚) M
  renâ¿áµ‰â—‹ Î·â‚ Î·â‚‚ (` i)         = ` & getâ—‹ Î·â‚ Î·â‚‚ i
  renâ¿áµ‰â—‹ Î·â‚ Î·â‚‚ (M âˆ™ N)       = _âˆ™_ & renâ¿áµ‰â—‹ Î·â‚ Î·â‚‚ M
                                   âŠ— renâ¿á¶ â—‹ Î·â‚ Î·â‚‚ N
  renâ¿áµ‰â—‹ Î·â‚ Î·â‚‚ (Ï€â‚ M)        = Ï€â‚ & renâ¿áµ‰â—‹ Î·â‚ Î·â‚‚ M
  renâ¿áµ‰â—‹ Î·â‚ Î·â‚‚ (Ï€â‚‚ M)        = Ï€â‚‚ & renâ¿áµ‰â—‹ Î·â‚ Î·â‚‚ M
  renâ¿áµ‰â—‹ Î·â‚ Î·â‚‚ (Ï† M)         = Ï† & renâ¿áµ‰â—‹ Î·â‚ Î·â‚‚ M
  renâ¿áµ‰â—‹ Î·â‚ Î·â‚‚ (M â‡ Nâ‚ âˆ¥ Nâ‚‚) = _â‡_âˆ¥_ & renâ¿áµ‰â—‹ Î·â‚ Î·â‚‚ M
                                     âŠ— renâ¿á¶ â—‹ (liftâ‚‘ Î·â‚) (liftâ‚‘ Î·â‚‚) Nâ‚
                                     âŠ— renâ¿á¶ â—‹ (liftâ‚‘ Î·â‚) (liftâ‚‘ Î·â‚‚) Nâ‚‚


mutual
  -- (âŒœ_âŒNf)
  embâ¿á¶  : âˆ€ {Î“ A} â†’ Î“ âŠ¢â¿á¶  A â†’ Î“ âŠ¢ A
  embâ¿á¶  (Æ› M)   = Æ› (embâ¿á¶  M)
  embâ¿á¶  (M , N) = embâ¿á¶  M , embâ¿á¶  N
  embâ¿á¶  Ï„       = Ï„
  embâ¿á¶  (Î¹â‚ M)  = Î¹â‚ (embâ¿á¶  M)
  embâ¿á¶  (Î¹â‚‚ M)  = Î¹â‚‚ (embâ¿á¶  M)
  embâ¿á¶  (ne M)  = embâ¿áµ‰ M

  -- (âŒœ_âŒNe)
  embâ¿áµ‰ : âˆ€ {Î“ A} â†’ Î“ âŠ¢â¿áµ‰ A â†’ Î“ âŠ¢ A
  embâ¿áµ‰ (` i)         = ` i
  embâ¿áµ‰ (M âˆ™ N)       = embâ¿áµ‰ M âˆ™ embâ¿á¶  N
  embâ¿áµ‰ (Ï€â‚ M)        = Ï€â‚ (embâ¿áµ‰ M)
  embâ¿áµ‰ (Ï€â‚‚ M)        = Ï€â‚‚ (embâ¿áµ‰ M)
  embâ¿áµ‰ (Ï† M)         = Ï† (embâ¿áµ‰ M)
  embâ¿áµ‰ (M â‡ Nâ‚ âˆ¥ Nâ‚‚) = embâ¿áµ‰ M â‡ embâ¿á¶  Nâ‚ âˆ¥ embâ¿á¶  Nâ‚‚


mutual
  -- (âŒœâŒNf-nat)
  natembâ¿á¶  : âˆ€ {A Î“ Î“â€²} â†’ (Î· : Î“â€² âŠ‡ Î“) (M : Î“ âŠ¢â¿á¶  A)
                        â†’ (embâ¿á¶  âˆ˜ renâ¿á¶  Î·) M â‰¡ (ren Î· âˆ˜ embâ¿á¶ ) M
  natembâ¿á¶  Î· (Æ› M)   = Æ› & natembâ¿á¶  (liftâ‚‘ Î·) M
  natembâ¿á¶  Î· (M , N) = _,_ & natembâ¿á¶  Î· M
                           âŠ— natembâ¿á¶  Î· N
  natembâ¿á¶  Î· Ï„       = refl
  natembâ¿á¶  Î· (Î¹â‚ M)  = Î¹â‚ & natembâ¿á¶  Î· M
  natembâ¿á¶  Î· (Î¹â‚‚ M)  = Î¹â‚‚ & natembâ¿á¶  Î· M
  natembâ¿á¶  Î· (ne M)  = natembâ¿áµ‰ Î· M

  -- (âŒœâŒNe-nat)
  natembâ¿áµ‰ : âˆ€ {A Î“ Î“â€²} â†’ (Î· : Î“â€² âŠ‡ Î“) (M : Î“ âŠ¢â¿áµ‰ A)
                        â†’ (embâ¿áµ‰ âˆ˜ renâ¿áµ‰ Î·) M â‰¡ (ren Î· âˆ˜ embâ¿áµ‰) M
  natembâ¿áµ‰ Î· (` i)         = refl
  natembâ¿áµ‰ Î· (M âˆ™ N)       = _âˆ™_ & natembâ¿áµ‰ Î· M
                                 âŠ— natembâ¿á¶  Î· N
  natembâ¿áµ‰ Î· (Ï€â‚ M)        = Ï€â‚ & natembâ¿áµ‰ Î· M
  natembâ¿áµ‰ Î· (Ï€â‚‚ M)        = Ï€â‚‚ & natembâ¿áµ‰ Î· M
  natembâ¿áµ‰ Î· (Ï† M)         = Ï† & natembâ¿áµ‰ Î· M
  natembâ¿áµ‰ Î· (M â‡ Nâ‚ âˆ¥ Nâ‚‚) = _â‡_âˆ¥_ & natembâ¿áµ‰ Î· M
                                   âŠ— natembâ¿á¶  (liftâ‚‘ Î·) Nâ‚
                                   âŠ— natembâ¿á¶  (liftâ‚‘ Î·) Nâ‚‚


--------------------------------------------------------------------------------


renâ¿á¶ Psh : ğ’¯ â†’ Presheafâ‚€ ğ—¢ğ—£ğ—˜
renâ¿á¶ Psh A =
  record
    { Fâ‚“   = _âŠ¢â¿á¶  A
    ; Fâ‚˜   = renâ¿á¶ 
    ; idFâ‚˜ = fext! idrenâ¿á¶ 
    ; Fâ‚˜â‹„  = Î» Î·â‚ Î·â‚‚ â†’ fext! (renâ¿á¶ â—‹ Î·â‚‚ Î·â‚)
    }

renâ¿áµ‰Psh : ğ’¯ â†’ Presheafâ‚€ ğ—¢ğ—£ğ—˜
renâ¿áµ‰Psh A =
  record
    { Fâ‚“   = _âŠ¢â¿áµ‰ A
    ; Fâ‚˜   = renâ¿áµ‰
    ; idFâ‚˜ = fext! idrenâ¿áµ‰
    ; Fâ‚˜â‹„  = Î» Î·â‚ Î·â‚‚ â†’ fext! (renâ¿áµ‰â—‹ Î·â‚‚ Î·â‚)
    }


embâ¿á¶ NT : âˆ€ {A} â†’ NaturalTransformation (renâ¿á¶ Psh A) (renPsh A)
embâ¿á¶ NT =
  record
    { N    = embâ¿á¶ 
    ; natN = Î» Î· â†’ fext! (Î» M â†’ natembâ¿á¶  Î· M)
    }

embâ¿áµ‰NT : âˆ€ {A} â†’ NaturalTransformation (renâ¿áµ‰Psh A) (renPsh A)
embâ¿áµ‰NT =
  record
    { N    = embâ¿áµ‰
    ; natN = Î» Î· â†’ fext! (Î» M â†’ natembâ¿áµ‰ Î· M)
    }


--------------------------------------------------------------------------------
