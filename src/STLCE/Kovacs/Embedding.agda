module STLCE.Kovacs.Embedding where

open import STLCE.Syntax public
open import Category


--------------------------------------------------------------------------------


-- Embeddings (OPE ; âˆ™ ; drop ; keep)
infix 4 _âŠ‡_
data _âŠ‡_ : ğ’ â†’ ğ’ â†’ Set
  where
    done  : âˆ… âŠ‡ âˆ…

    wkâ‚‘   : âˆ€ {Î“ Î“â€² A} â†’ (Î· : Î“â€² âŠ‡ Î“)
                       â†’ Î“â€² , A âŠ‡ Î“

    liftâ‚‘ : âˆ€ {Î“ Î“â€² A} â†’ (Î· : Î“â€² âŠ‡ Î“)
                       â†’ Î“â€² , A âŠ‡ Î“ , A


idâ‚‘ : âˆ€ {Î“} â†’ Î“ âŠ‡ Î“
idâ‚‘ {âˆ…}     = done
idâ‚‘ {Î“ , A} = liftâ‚‘ idâ‚‘

-- (_âˆ˜â‚‘_)
_â—‹_ : âˆ€ {Î“ Î“â€² Î“â€³} â†’ Î“â€² âŠ‡ Î“ â†’ Î“â€³ âŠ‡ Î“â€² â†’ Î“â€³ âŠ‡ Î“
Î·â‚‚       â—‹ done     = Î·â‚‚
Î·â‚‚       â—‹ wkâ‚‘ Î·â‚   = wkâ‚‘ (Î·â‚‚ â—‹ Î·â‚)
wkâ‚‘ Î·â‚‚   â—‹ liftâ‚‘ Î·â‚ = wkâ‚‘ (Î·â‚‚ â—‹ Î·â‚)
liftâ‚‘ Î·â‚‚ â—‹ liftâ‚‘ Î·â‚ = liftâ‚‘ (Î·â‚‚ â—‹ Î·â‚)

-- (idlâ‚‘)
lidâ—‹ : âˆ€ {Î“ Î“â€²} â†’ (Î· : Î“â€² âŠ‡ Î“)
                â†’ idâ‚‘ â—‹ Î· â‰¡ Î·
lidâ—‹ done      = refl
lidâ—‹ (wkâ‚‘ Î·)   = wkâ‚‘ & lidâ—‹ Î·
lidâ—‹ (liftâ‚‘ Î·) = liftâ‚‘ & lidâ—‹ Î·

-- (idrâ‚‘)
ridâ—‹ : âˆ€ {Î“ Î“â€²} â†’ (Î· : Î“â€² âŠ‡ Î“)
                â†’ Î· â—‹ idâ‚‘ â‰¡ Î·
ridâ—‹ done      = refl
ridâ—‹ (wkâ‚‘ Î·)   = wkâ‚‘ & ridâ—‹ Î·
ridâ—‹ (liftâ‚‘ Î·) = liftâ‚‘ & ridâ—‹ Î·

-- (assâ‚‘)
assocâ—‹ : âˆ€ {Î“ Î“â€² Î“â€³ Î“â€´} â†’ (Î·â‚ : Î“â€´ âŠ‡ Î“â€³) (Î·â‚‚ : Î“â€³ âŠ‡ Î“â€²) (Î·â‚ƒ : Î“â€² âŠ‡ Î“)
                        â†’ (Î·â‚ƒ â—‹ Î·â‚‚) â—‹ Î·â‚ â‰¡ Î·â‚ƒ â—‹ (Î·â‚‚ â—‹ Î·â‚)
assocâ—‹ done       Î·â‚‚         Î·â‚ƒ         = refl
assocâ—‹ (wkâ‚‘ Î·â‚)   Î·â‚‚         Î·â‚ƒ         = wkâ‚‘ & assocâ—‹ Î·â‚ Î·â‚‚ Î·â‚ƒ
assocâ—‹ (liftâ‚‘ Î·â‚) (wkâ‚‘ Î·â‚‚)   Î·â‚ƒ         = wkâ‚‘ & assocâ—‹ Î·â‚ Î·â‚‚ Î·â‚ƒ
assocâ—‹ (liftâ‚‘ Î·â‚) (liftâ‚‘ Î·â‚‚) (wkâ‚‘ Î·â‚ƒ)   = wkâ‚‘ & assocâ—‹ Î·â‚ Î·â‚‚ Î·â‚ƒ
assocâ—‹ (liftâ‚‘ Î·â‚) (liftâ‚‘ Î·â‚‚) (liftâ‚‘ Î·â‚ƒ) = liftâ‚‘ & assocâ—‹ Î·â‚ Î·â‚‚ Î·â‚ƒ


--------------------------------------------------------------------------------


-- (âˆˆâ‚‘)
getâ‚‘ : âˆ€ {Î“ Î“â€² A} â†’ Î“â€² âŠ‡ Î“ â†’ Î“ âˆ‹ A â†’ Î“â€² âˆ‹ A
getâ‚‘ done      i       = i
getâ‚‘ (wkâ‚‘ Î·)   i       = suc (getâ‚‘ Î· i)
getâ‚‘ (liftâ‚‘ Î·) zero    = zero
getâ‚‘ (liftâ‚‘ Î·) (suc i) = suc (getâ‚‘ Î· i)

-- (âˆˆ-idâ‚‘)
idgetâ‚‘ : âˆ€ {Î“ A} â†’ (i : Î“ âˆ‹ A)
                 â†’ getâ‚‘ idâ‚‘ i â‰¡ i
idgetâ‚‘ zero    = refl
idgetâ‚‘ (suc i) = suc & idgetâ‚‘ i

-- (âˆˆ-âˆ˜â‚‘)
getâ—‹ : âˆ€ {Î“ Î“â€² Î“â€³ A} â†’ (Î·â‚ : Î“â€³ âŠ‡ Î“â€²) (Î·â‚‚ : Î“â€² âŠ‡ Î“) (i : Î“ âˆ‹ A)
                     â†’ getâ‚‘ (Î·â‚‚ â—‹ Î·â‚) i â‰¡ (getâ‚‘ Î·â‚ âˆ˜ getâ‚‘ Î·â‚‚) i
getâ—‹ done       done       ()
getâ—‹ (wkâ‚‘ Î·â‚)   Î·â‚‚         i       = suc & getâ—‹ Î·â‚ Î·â‚‚ i
getâ—‹ (liftâ‚‘ Î·â‚) (wkâ‚‘ Î·â‚‚)   i       = suc & getâ—‹ Î·â‚ Î·â‚‚ i
getâ—‹ (liftâ‚‘ Î·â‚) (liftâ‚‘ Î·â‚‚) zero    = refl
getâ—‹ (liftâ‚‘ Î·â‚) (liftâ‚‘ Î·â‚‚) (suc i) = suc & getâ—‹ Î·â‚ Î·â‚‚ i


--------------------------------------------------------------------------------


-- (Tmâ‚‘)
ren : âˆ€ {Î“ Î“â€² A} â†’ Î“â€² âŠ‡ Î“ â†’ Î“ âŠ¢ A â†’ Î“â€² âŠ¢ A
ren Î· (` i)         = ` (getâ‚‘ Î· i)
ren Î· (Æ› M)         = Æ› (ren (liftâ‚‘ Î·) M)
ren Î· (M âˆ™ N)       = ren Î· M âˆ™ ren Î· N
ren Î· (M , N)       = ren Î· M , ren Î· N
ren Î· (Ï€â‚ M)        = Ï€â‚ (ren Î· M)
ren Î· (Ï€â‚‚ M)        = Ï€â‚‚ (ren Î· M)
ren Î· Ï„             = Ï„
ren Î· (Ï† M)         = Ï† (ren Î· M)
ren Î· (Î¹â‚ M)        = Î¹â‚ (ren Î· M)
ren Î· (Î¹â‚‚ M)        = Î¹â‚‚ (ren Î· M)
ren Î· (M â‡ Nâ‚ âˆ¥ Nâ‚‚) = ren Î· M â‡ ren (liftâ‚‘ Î·) Nâ‚ âˆ¥ ren (liftâ‚‘ Î·) Nâ‚‚

wk : âˆ€ {B Î“ A} â†’ Î“ âŠ¢ A â†’ Î“ , B âŠ¢ A
wk M = ren (wkâ‚‘ idâ‚‘) M

liftwk : âˆ€ {C Î“ A B} â†’ Î“ , A âŠ¢ B â†’ Î“ , C , A âŠ¢ B
liftwk M = ren (liftâ‚‘ (wkâ‚‘ idâ‚‘)) M

-- (Tm-idâ‚‘)
idren : âˆ€ {Î“ A} â†’ (M : Î“ âŠ¢ A)
                â†’ ren idâ‚‘ M â‰¡ M
idren (` i)         = ` & idgetâ‚‘ i
idren (Æ› M)         = Æ› & idren M
idren (M âˆ™ N)       = _âˆ™_ & idren M
                          âŠ— idren N
idren (M , N)       = _,_ & idren M
                          âŠ— idren N
idren (Ï€â‚ M)        = Ï€â‚ & idren M
idren (Ï€â‚‚ M)        = Ï€â‚‚ & idren M
idren Ï„             = refl
idren (Ï† M)         = Ï† & idren M
idren (Î¹â‚ M)        = Î¹â‚ & idren M
idren (Î¹â‚‚ M)        = Î¹â‚‚ & idren M
idren (M â‡ Nâ‚ âˆ¥ Nâ‚‚) = _â‡_âˆ¥_ & idren M
                            âŠ— idren Nâ‚
                            âŠ— idren Nâ‚‚

-- (Tm-âˆ˜â‚‘)
renâ—‹ : âˆ€ {Î“ Î“â€² Î“â€³ A} â†’ (Î·â‚ : Î“â€³ âŠ‡ Î“â€²) (Î·â‚‚ : Î“â€² âŠ‡ Î“) (M : Î“ âŠ¢ A)
                     â†’ ren (Î·â‚‚ â—‹ Î·â‚) M â‰¡ (ren Î·â‚ âˆ˜ ren Î·â‚‚) M
renâ—‹ Î·â‚ Î·â‚‚ (` i)         = ` & getâ—‹ Î·â‚ Î·â‚‚ i
renâ—‹ Î·â‚ Î·â‚‚ (Æ› M)         = Æ› & renâ—‹ (liftâ‚‘ Î·â‚) (liftâ‚‘ Î·â‚‚) M
renâ—‹ Î·â‚ Î·â‚‚ (M âˆ™ N)       = _âˆ™_ & renâ—‹ Î·â‚ Î·â‚‚ M
                               âŠ— renâ—‹ Î·â‚ Î·â‚‚ N
renâ—‹ Î·â‚ Î·â‚‚ (M , N)       = _,_ & renâ—‹ Î·â‚ Î·â‚‚ M
                               âŠ— renâ—‹ Î·â‚ Î·â‚‚ N
renâ—‹ Î·â‚ Î·â‚‚ (Ï€â‚ M)        = Ï€â‚ & renâ—‹ Î·â‚ Î·â‚‚ M
renâ—‹ Î·â‚ Î·â‚‚ (Ï€â‚‚ M)        = Ï€â‚‚ & renâ—‹ Î·â‚ Î·â‚‚ M
renâ—‹ Î·â‚ Î·â‚‚ Ï„             = refl
renâ—‹ Î·â‚ Î·â‚‚ (Ï† M)         = Ï† & renâ—‹ Î·â‚ Î·â‚‚ M
renâ—‹ Î·â‚ Î·â‚‚ (Î¹â‚ M)        = Î¹â‚ & renâ—‹ Î·â‚ Î·â‚‚ M
renâ—‹ Î·â‚ Î·â‚‚ (Î¹â‚‚ M)        = Î¹â‚‚ & renâ—‹ Î·â‚ Î·â‚‚ M
renâ—‹ Î·â‚ Î·â‚‚ (M â‡ Nâ‚ âˆ¥ Nâ‚‚) = _â‡_âˆ¥_ & renâ—‹ Î·â‚ Î·â‚‚ M
                                 âŠ— renâ—‹ (liftâ‚‘ Î·â‚) (liftâ‚‘ Î·â‚‚) Nâ‚
                                 âŠ— renâ—‹ (liftâ‚‘ Î·â‚) (liftâ‚‘ Î·â‚‚) Nâ‚‚


--------------------------------------------------------------------------------


ğ—¢ğ—£ğ—˜ : Category ğ’ _âŠ‡_
ğ—¢ğ—£ğ—˜ =
  record
    { idâ‚“    = idâ‚‘
    ; _â‹„_    = _â—‹_
    ; lidâ‹„   = lidâ—‹
    ; ridâ‹„   = ridâ—‹
    ; assocâ‹„ = assocâ—‹
    }


getâ‚‘Psh : ğ’¯ â†’ Presheafâ‚€ ğ—¢ğ—£ğ—˜
getâ‚‘Psh A =
  record
    { Fâ‚“   = _âˆ‹ A
    ; Fâ‚˜   = getâ‚‘
    ; idFâ‚˜ = fext! idgetâ‚‘
    ; Fâ‚˜â‹„  = Î» Î·â‚ Î·â‚‚ â†’ fext! (getâ—‹ Î·â‚‚ Î·â‚)
    }

renPsh : ğ’¯ â†’ Presheafâ‚€ ğ—¢ğ—£ğ—˜
renPsh A =
  record
    { Fâ‚“   = _âŠ¢ A
    ; Fâ‚˜   = ren
    ; idFâ‚˜ = fext! idren
    ; Fâ‚˜â‹„  = Î» Î·â‚ Î·â‚‚ â†’ fext! (renâ—‹ Î·â‚‚ Î·â‚)
    }


--------------------------------------------------------------------------------
